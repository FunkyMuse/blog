I""8<p>We’ve all came to a decision to go and do something else while waiting for the build.gradle to finish, something like: people get married or divorced, learn to fly a plane, build a rocket ship out of LEGO or take one hour poo.</p>

<p>You downloaded Android studio and you just created an empty project and you had it run for the first time right?</p>

<p>Well this should look familiar to you if you profile your build with</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="o">./</span><span class="n">gradlew</span> <span class="o">--</span><span class="n">profile</span> <span class="o">--</span><span class="n">offline</span> <span class="o">--</span><span class="n">rerun</span><span class="o">-</span><span class="n">tasks</span> <span class="n">assembleDebug</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>24 seconds, that’s not good.</p>

<p>Alright here we go configuring gradle.</p>

<p>Our first step will be configuring on demand, what does this mean?</p>
<blockquote>
  <p>Configuration on demand mode attempts to configure only projects that are relevant for requested tasks, i.e. it only executes the build.gradle file of projects that are participating in the build. This way, the configuration time of a large multi-project build can be reduced. In the long term, this mode will become the default mode, possibly the only mode for Gradle build execution.</p>
</blockquote>

<p>Inside your gradle.properties</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">configureondemand</span><span class="o">=</span><span class="kc">true</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>In case you get some weird error that a task failed mainly using Kotlin DSL scripts or groovy, disable configureOnDemand, you can look at why, at this issue.</p>

<p>It’s good to increase the Java heap memory, of course if your RAM allows it, better not develop apps with &lt;16GB RAM</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">jvmargs</span><span class="o">=-</span><span class="n">Xmx1536m</span> <span class="o">-</span><span class="nl">XX:</span><span class="o">+</span><span class="n">UseParallelGC</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>and we’re enabling parallel garbage collection.</p>

<p>You’re building Android projects using Kotlin right, well lemme reveal a dirty secret, if you’ve used KAPT, it’s worker is not enabled, yep, to make it so add</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">kapt</span><span class="o">.</span><span class="na">use</span><span class="o">.</span><span class="na">worker</span><span class="o">.</span><span class="na">api</span> <span class="o">=</span> <span class="kc">true</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Get ready for more gradle.properties</p>

<p>Building a multi-module project?</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">parallel</span><span class="o">=</span><span class="kc">true</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Get leverage of caching mecnanism? Say no more, in newer versions of Gradle I it’s enabled by default, so there goes another valuable lesson, ALWAYS KEEP your GRADLE up to date with the LATEST VERSION, if you’re unaffected by these caps, just use:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">caching</span><span class="o">=</span><span class="kc">true</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Using room?</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">room</span><span class="o">.</span><span class="na">incremental</span> <span class="o">=</span> <span class="kc">true</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>But wait, that’s not all if you’re using Room, inside your build.gradle find your</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="n">defaultConfig</span> <span class="o">{</span>

              
<span class="o">}</span>        
</pre></td></tr></tbody></table></code></pre></div></div>
<p>and add</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>
                <span class="n">javaCompileOptions</span> <span class="o">{</span>
           
                <span class="n">annotationProcessorOptions</span> <span class="o">{</span>
               
                <span class="n">arguments</span> <span class="o">=</span> <span class="o">[</span><span class="s2">"room.incremental"</span><span class="o">:</span><span class="s2">"true"</span><span class="o">]</span>
           
                <span class="o">}</span>
        <span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p>Get ready for one more gradle.properties addition, ladies and gentleman, the new citizen, configuration cache and it’s brother file watcher</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>
<span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">unsafe</span><span class="o">.</span><span class="na">watch</span><span class="o">-</span><span class="n">fs</span><span class="o">=</span><span class="kc">true</span>

<span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">unsafe</span><span class="o">.</span><span class="na">configuration</span><span class="o">-</span><span class="n">cache</span><span class="o">=</span><span class="kc">true</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you decide not to use webP images and stick to PNGs</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>                <span class="n">buildTypes</span> <span class="o">{</span>
       
                <span class="n">release</span> <span class="o">{</span>
           
                <span class="c1">// Disables PNG crunching for the release build type or maybe</span>
                <span class="n">debug</span> <span class="n">too</span><span class="o">?</span>
           
                <span class="n">crunchPngs</span> <span class="kc">false</span>
       
                <span class="o">}</span>
              <span class="o">}</span>  
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Never in your life write dependency using the + format, it adds to the build time if you add just one dependency like this and imagine if you add more, your build won’t even finish by the time you go to sleep, so avoid something like this</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">implementation</span> <span class="s1">'androidx.appcompat:appcompat:1.+'</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Many of us use Crashlytics or some form of crash reporting tool, I built my own called Crashy to avoid the slowdowns, leveraging AndroidX Startup and over-configuration of Crashyltics, how can you configure Crashlytics?
Well, no worries, there you go.</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="n">buildTypes</span> <span class="o">{</span>

  <span class="n">debug</span> <span class="o">{</span>
     <span class="n">manifestPlaceholders</span> <span class="o">=</span> <span class="o">[</span><span class="nl">crashlytics:</span> <span class="s2">"false"</span><span class="o">]</span>
     <span class="n">crunchPngs</span> <span class="kc">false</span> <span class="c1">//you can read about that a little bit above</span>

     <span class="n">firebaseCrashlytics</span> <span class="o">{</span>
       <span class="n">mappingFileUploadEnabled</span> <span class="kc">false</span>
     <span class="o">}</span>
   <span class="o">}</span>

   <span class="n">release</span> <span class="o">{</span>
      <span class="n">manifestPlaceholders</span> <span class="o">=</span> <span class="o">[</span><span class="nl">crashlytics:</span> <span class="s2">"true"</span><span class="o">]</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Alright, let’s go step by step:</p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">manifestPlaceholders</span> <span class="o">=</span> <span class="o">[</span><span class="nl">crashlytics:</span> <span class="s2">"false"</span><span class="o">,</span> <span class="nl">analytics:</span> <span class="s2">"false"</span><span class="o">]</span> 
</pre></td></tr></tbody></table></code></pre></div></div>
<p>this just disables the crashyltics and analytics from the manifest, but how do you do that?</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"firebase_crashlytics_collection_enabled"</span>
    <span class="na">android:value=</span><span class="s">"${crashlytics}"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre> <span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"firebase_analytics_collection_deactivated"</span>
    <span class="na">android:value=</span><span class="s">"${analytics}"</span><span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Wherever your Crashyltics initialization is, just use</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nc">FirebaseCrashlytics</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">().</span><span class="nf">setCrashlyticsCollectionEnabled</span><span class="p">(!</span><span class="nc">Buildconfig</span><span class="p">.</span><span class="nc">DEBUG</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>we do the same for the analytics</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nc">FirebaseAnalytics</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">().</span><span class="nf">setAnalyticsCollectionEnabled</span><span class="p">(!</span><span class="nc">BuildConfig</span><span class="p">.</span><span class="nc">DEBUG</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">mappingFileUploadEnabled</code></p>

<p>If you don’t need crash reporting for your debug build,you can speed up your build by disabling mapping file uploading.</p>

<p>And now let’s see</p>

<p>We have 4secs build time, including Dagger’s kapt, Nav’s kapt etc..</p>

:ET