<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="View binding for the lazy" /><meta name="author" content="FunkyMuse" /><meta property="og:locale" content="en_US" /><meta name="description" content="Blog containing Kotlin and Android goodies." /><meta property="og:description" content="Blog containing Kotlin and Android goodies." /><link rel="canonical" href="https://funkymuse.github.io/posts/view-binding-for-the-lazy/" /><meta property="og:url" content="https://funkymuse.github.io/posts/view-binding-for-the-lazy/" /><meta property="og:site_name" content="FunkyMuse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-05T11:46:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="View binding for the lazy" /><meta name="twitter:site" content="@funky_muse" /><meta name="twitter:creator" content="@FunkyMuse" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"FunkyMuse"},"description":"Blog containing Kotlin and Android goodies.","url":"https://funkymuse.github.io/posts/view-binding-for-the-lazy/","@type":"BlogPosting","headline":"View binding for the lazy","dateModified":"2020-11-05T11:46:00+01:00","datePublished":"2020-11-05T11:46:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://funkymuse.github.io/posts/view-binding-for-the-lazy/"},"@context":"https://schema.org"}</script><title>View binding for the lazy | FunkyMuse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">FunkyMuse</a></div><div class="site-subtitle font-italic">Anything which inspires everything</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/apps/" class="nav-link"> <i class="fa-fw fas fa-mobile ml-xl-3 mr-xl-3 unloaded"></i> <span>APPLICATIONS</span> </a><li class="nav-item"> <a href="/hire_me/" class="nav-link"> <i class="fa-fw fas fa-code ml-xl-3 mr-xl-3 unloaded"></i> <span>HIRE ME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/FunkyMuse" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/funky_muse" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['funkymuse','protonmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>View binding for the lazy</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>View binding for the lazy</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> FunkyMuse </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 5, 2020, 11:46 AM +0100" prep="on" > Nov 5, 2020 <i class="unloaded">2020-11-05T11:46:00+01:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1926 words">10 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2/1.png" class="center" /></p><p>If you ever looked at this image and wondered, why this blog post is written when I as a developer was promised a low amount of code needed for view binding to work, well technically that’s true, but also false at the same time.</p><p>You see… everything in Android is complicated and you should make peace with it, well you might ask yourself how? Just build a workaround solution that’ll ease your life, thank me later.</p><p>TL:DR; use the <a href="https://github.com/FunkyMuse/KAHelpers/tree/master/viewbinding">library/helper</a> I published to forget even copy/pasting the code from this post.</p><p>On a normal day you’ll have something like</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">activityMainBinding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span>
<span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    <span class="n">activityMainBinding</span> <span class="p">=</span> <span class="nc">ActivityMainBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">inflater</span><span class="p">)</span>
    <span class="nf">setContentView</span><span class="p">(</span><span class="n">activityMainBinding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>which is a lot of code to write, whopping 3 lines.</p><p>Okay we can definitely make it better, thanks to Kotlin.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="kd">val</span> <span class="py">activityMainBinding</span> <span class="k">by</span> <span class="nf">viewBinder</span><span class="p">(</span><span class="nc">ActivityMainBinding</span><span class="o">::</span><span class="n">inflate</span><span class="p">)</span>
<span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    <span class="nf">setContentView</span><span class="p">(</span><span class="n">activityMainBinding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>That looks way better doesn’t it?</p><p>What’s happening here?</p><blockquote><p>We have an inline delegate + extension function thanks to the lazy (more on that) We access ActivityMainBinding’s function inflate via reference<br /> Magically inflated</p></blockquote><p>Let’s take a look at our viewBinder function</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewBinding</span><span class="p">&gt;</span> <span class="nc">Activity</span><span class="p">.</span><span class="nf">viewBinder</span><span class="p">(</span>
        <span class="k">crossinline</span> <span class="n">bindingInflater</span><span class="p">:</span> <span class="p">(</span><span class="nc">LayoutInflater</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">T</span><span class="p">)</span> <span class="p">=</span>
        <span class="nf">lazy</span><span class="p">(</span><span class="nc">LazyThreadSafetyMode</span><span class="p">.</span><span class="nc">NONE</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bindingInflater</span><span class="p">.</span><span class="nf">invoke</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">)</span>
        <span class="p">}</span>
</pre></table></code></div></div><p>We have an inline function of course to minimize the overhead, then we have another function as a parameter that takes the LayoutInflater as a parameter and returns the generic T which is our ViewBinding.</p><p>Our lazy delegate provided by Kotlin is how we get the by in our viewBinder and we use LazyThreadSafeMode.NONE since the view can’t be accessed on other threads and thus we don’t need the lazy to create even more overhead with the synchronizations.</p><p>We marked our bindingInflater function as a crossinline since it’s called in another scope of a function (lazy), and then we just invoke it (which means inflating our view binding) with a parameter of layoutInflater which is context.getLayoutInflater in the background.</p><p>Now we have to write only 2 lines of code instead of 3.</p><p>But that’s too much, 2 lines of code, nope, we can do better, we are lazy.</p><p>Le few moments later and here we are.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="kd">val</span> <span class="py">activityMainBinding</span> <span class="k">by</span> <span class="nf">viewBinding</span><span class="p">(</span><span class="nc">ActivityMainBinding</span><span class="o">::</span><span class="n">inflate</span><span class="p">)</span>
<span class="k">override</span> <span class="k">fun</span> <span class="nf">onPostCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onPostCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>Same, but different, but still the same, huh? Let’s see.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewBinding</span><span class="p">&gt;</span> <span class="nc">AppCompatActivity</span><span class="p">.</span><span class="nf">viewBinding</span><span class="p">(</span>
        <span class="n">bindingInflater</span><span class="p">:</span> <span class="p">(</span><span class="nc">LayoutInflater</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">T</span><span class="p">,</span>
        <span class="n">beforeSetContent</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{})</span> <span class="p">=</span>
        <span class="nc">ActivityViewBindingDelegate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">bindingInflater</span><span class="p">,</span> <span class="n">beforeSetContent</span><span class="p">)</span>
</pre></table></code></div></div><p>Okay then, we have almost the same logic, except this time it ain’t an inline function and there’s another beforeSetContent function and another class <code class="language-plaintext highlighter-rouge">ActivityViewBindingDelegate</code>, let’s jump to it.</p><p>This class is a really simple class, it leverages Kotlin’s delegates</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">ActivityViewBindingDelegate</span><span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewBinding</span><span class="p">&gt;(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">activity</span><span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">viewBinder</span><span class="p">:</span> <span class="p">(</span><span class="nc">LayoutInflater</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">T</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">beforeSetContent</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{}</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ReadOnlyProperty</span><span class="p">&lt;</span><span class="nc">AppCompatActivity</span><span class="p">,</span> <span class="nc">T</span><span class="p">&gt;,</span> <span class="nc">LifecycleObserver</span>
</pre></table></code></div></div><p>It has a generic of a view binding type and generally identical parameters as the function above and instead of an extension function our AppCompatActivity is a the type of object which owns the property that’s delegated, in our case the ViewBinding.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">ActivityViewBindingDelegate</span><span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewBinding</span><span class="p">&gt;(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">activity</span><span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">viewBinder</span><span class="p">:</span> <span class="p">(</span><span class="nc">LayoutInflater</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">T</span><span class="p">,</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">beforeSetContent</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{}</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ReadOnlyProperty</span><span class="p">&lt;</span><span class="nc">AppCompatActivity</span><span class="p">,</span> <span class="nc">T</span><span class="p">&gt;,</span> <span class="nc">LifecycleObserver</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">activityBinding</span><span class="p">:</span> <span class="nc">T</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">activity</span><span class="p">.</span><span class="n">lifecycle</span><span class="p">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@OnLifecycleEvent</span><span class="p">(</span><span class="nc">Lifecycle</span><span class="p">.</span><span class="nc">Event</span><span class="p">.</span><span class="nc">ON_CREATE</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">createBinding</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">initialize</span><span class="p">()</span>
        <span class="nf">beforeSetContent</span><span class="p">()</span>
        <span class="n">activity</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="n">activityBinding</span><span class="o">?.</span><span class="n">root</span><span class="p">)</span>
        <span class="n">activity</span><span class="p">.</span><span class="n">lifecycle</span><span class="p">.</span><span class="nf">removeObserver</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">activityBinding</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">activityBinding</span> <span class="p">=</span> <span class="nf">viewBinder</span><span class="p">(</span><span class="n">activity</span><span class="p">.</span><span class="n">layoutInflater</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">thisRef</span><span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">,</span> <span class="n">property</span><span class="p">:</span> <span class="nc">KProperty</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
        <span class="nf">ensureMainThread</span><span class="p">()</span>
        <span class="nf">initialize</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">activityBinding</span><span class="o">!!</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">ensureMainThread</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nc">Looper</span><span class="p">.</span><span class="nf">myLooper</span><span class="p">()</span> <span class="p">!=</span> <span class="nc">Looper</span><span class="p">.</span><span class="nf">getMainLooper</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nc">IllegalThreadStateException</span><span class="p">(</span><span class="s">"View can be accessed only on the main thread."</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Let’s do a step by ste…</p><p>We have our</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="kd">var</span> <span class="py">activityBinding</span><span class="p">:</span> <span class="nc">T</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
</pre></table></code></div></div><p>Which holds our view binding and once the delegate’s constructor gets called we initialize our LifecycleObserver by calling</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nf">init</span> <span class="p">{</span>
    <span class="n">activity</span><span class="p">.</span><span class="n">lifecycle</span><span class="p">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>so that we can listen to events like Lifecycle.Event.OnSomething</p><p>we need to initialize our view binding</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@OnLifecycleEvent</span><span class="p">(</span><span class="nc">Lifecycle</span><span class="p">.</span><span class="nc">Event</span><span class="p">.</span><span class="nc">ON_CREATE</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">createBinding</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">initialize</span><span class="p">()</span>
    <span class="nf">beforeSetContent</span><span class="p">()</span>
    <span class="n">activity</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="n">activityBinding</span><span class="o">?.</span><span class="n">root</span><span class="p">)</span>
    <span class="n">activity</span><span class="p">.</span><span class="n">lifecycle</span><span class="p">.</span><span class="nf">removeObserver</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">fun</span> <span class="nf">initialize</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">activityBinding</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">activityBinding</span> <span class="p">=</span> <span class="nf">viewBinder</span><span class="p">(</span><span class="n">activity</span><span class="p">.</span><span class="n">layoutInflater</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We have nearly the same logic as above but we have</p><ol><li>initialize() - self explanatory<li>beforeSetContent() - which takes place before setContentView(), this is useful for all the Dagger component 3.injections and other stuff you need to do before setContentView happens<li>Then we set the content view<li>We remove the lifecycle observer???? yeah we do because setContentView has to happen only once, call it magic, call it true.</ol><p>We override the</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">override</span> <span class="k">fun</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">thisRef</span><span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">,</span> <span class="n">property</span><span class="p">:</span> <span class="nc">KProperty</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
    <span class="nf">ensureMainThread</span><span class="p">()</span>
    <span class="nf">initialize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">activityBinding</span><span class="o">!!</span>
<span class="p">}</span>
</pre></table></code></div></div><p>C’mon man, already… it was supposed to be simple, it isn’t….. not yet.</p><p>We have to ensure access only on the main thread and then do initialization phase in case it’s a null (process death enters the chat).</p><p>and now we can do</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="kd">val</span> <span class="py">activityMainBinding</span> <span class="k">by</span> <span class="nf">viewBinding</span><span class="p">(</span><span class="nc">ActivityMainBinding</span><span class="o">::</span><span class="n">inflate</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//initialize Dagger voodoo or something else before setContentView</span>
<span class="p">}</span>
</pre></table></code></div></div><p>with just one (almost one if you don’t do dagger initialization or something else you can omit the ‘{}’)</p><p>Why are we using onPostCreate, well the lifecycle observe propagates the lifecycle event as a reflective call to the function where we initialize the view binding, therefore we have to use the view somehow and that’s why we do it onPostCreate, this function is a call in-between onCreate and onStart, it’s where you do final initialization before usage.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="kd">val</span> <span class="py">activityMainBinding</span> <span class="k">by</span> <span class="nf">viewBinding</span><span class="p">(</span><span class="nc">ActivityMainBinding</span><span class="o">::</span><span class="n">inflate</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//initialize Dagger voodoo</span>
<span class="p">}</span>
<span class="k">override</span> <span class="k">fun</span> <span class="nf">onPostCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="nf">onPostCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>ain’t it elegant?</p><p>You might ask yourself if we’ve forgotten the complication of our lives called Fragments, nope, not yet.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">TestFragment</span> <span class="p">:</span> <span class="nc">Fragment</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">testFragmentBinding</span><span class="p">:</span> <span class="nc">TestFragmentBinding</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreateView</span><span class="p">(</span><span class="n">inflater</span><span class="p">:</span> <span class="nc">LayoutInflater</span><span class="p">,</span> <span class="n">container</span><span class="p">:</span> <span class="nc">ViewGroup</span><span class="p">?,</span> <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?):</span> <span class="nc">View</span><span class="p">?</span> <span class="p">{</span>
        <span class="n">testFragmentBinding</span> <span class="p">=</span> <span class="nc">TestFragmentBinding</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">inflater</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">testFragmentBinding</span><span class="o">?.</span><span class="n">root</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onDestroyView</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onDestroyView</span><span class="p">()</span>
        <span class="n">testFragmentBinding</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>We have to create it, inflate it, set it to null in onDestroyView()</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2/2.gif" class="center" /></p><p>But why set it to null?</p><p>Fragments can be detached (when that happens the view is the only one that gets killed) but they’ll still live, except if we don’t destroy the view, mister memory leak appears.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">TestFragment</span> <span class="p">:</span> <span class="nc">Fragment</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">test_fragment</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">testFragmentBinding</span> <span class="k">by</span> <span class="nf">viewBinding</span><span class="p">(</span><span class="nc">TestFragmentBinding</span><span class="o">::</span><span class="n">bind</span><span class="p">)</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="nc">View</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="c1">//do your stuff</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewBinding</span><span class="p">&gt;</span> <span class="nc">Fragment</span><span class="p">.</span><span class="nf">viewBinding</span><span class="p">(</span>
        <span class="n">viewBindingFactory</span><span class="p">:</span> <span class="p">(</span><span class="nc">View</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">T</span><span class="p">,</span> 
        <span class="n">disposeEvents</span><span class="p">:</span> <span class="nc">T</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{})</span> <span class="p">=</span>
        <span class="nc">FragmentViewBindingDelegate</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">viewBindingFactory</span><span class="p">,</span> <span class="n">disposeEvents</span><span class="p">)</span>
</pre></table></code></div></div><p>Similar to our activity case, but instead, our parameter here is a view and we have disposeEvents which is invoked on an object and this FragmentViewBindingDelegate inspired by Zhuinden’s post</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">FragmentViewBindingDelegate</span><span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewBinding</span><span class="p">&gt;(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">fragment</span><span class="p">:</span> <span class="nc">Fragment</span><span class="p">,</span>
                                                   <span class="k">private</span> <span class="kd">val</span> <span class="py">viewBinder</span><span class="p">:</span> <span class="p">(</span><span class="nc">View</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">T</span><span class="p">,</span>
                                                   <span class="k">private</span> <span class="kd">val</span> <span class="py">disposeEvents</span><span class="p">:</span> <span class="nc">T</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{})</span> <span class="p">:</span> <span class="nc">ReadOnlyProperty</span><span class="p">&lt;</span><span class="nc">Fragment</span><span class="p">,</span> <span class="nc">T</span><span class="p">&gt;,</span> <span class="nc">LifecycleObserver</span> <span class="p">{</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">fragment</span><span class="p">.</span><span class="nf">observeLifecycleOwnerThroughLifecycleCreation</span> <span class="p">{</span>
            <span class="n">lifecycle</span><span class="p">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">this</span><span class="nd">@FragmentViewBindingDelegate</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">inline</span> <span class="k">fun</span> <span class="nc">Fragment</span><span class="p">.</span><span class="nf">observeLifecycleOwnerThroughLifecycleCreation</span><span class="p">(</span><span class="k">crossinline</span> <span class="n">viewOwner</span><span class="p">:</span> <span class="nc">LifecycleOwner</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">lifecycle</span><span class="p">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="kd">object</span> <span class="err">: </span><span class="nc">DefaultLifecycleObserver</span> <span class="p">{</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">owner</span><span class="p">:</span> <span class="nc">LifecycleOwner</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">viewLifecycleOwnerLiveData</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="nd">@observeLifecycleOwnerThroughLifecycleCreation</span><span class="p">,</span> <span class="nc">Observer</span> <span class="p">{</span> <span class="n">viewLifecycleOwner</span> <span class="p">-&gt;</span>
                    <span class="n">viewLifecycleOwner</span><span class="p">.</span><span class="nf">viewOwner</span><span class="p">()</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">fragmentBinding</span><span class="p">:</span> <span class="nc">T</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="nd">@OnLifecycleEvent</span><span class="p">(</span><span class="nc">Lifecycle</span><span class="p">.</span><span class="nc">Event</span><span class="p">.</span><span class="nc">ON_DESTROY</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">disposeBinding</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fragmentBinding</span><span class="o">?.</span><span class="nf">disposeEvents</span><span class="p">()</span>
        <span class="n">fragmentBinding</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">thisRef</span><span class="p">:</span> <span class="nc">Fragment</span><span class="p">,</span> <span class="n">property</span><span class="p">:</span> <span class="nc">KProperty</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
        <span class="nf">ensureMainThread</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">binding</span> <span class="p">=</span> <span class="n">fragmentBinding</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">binding</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">binding</span>
        <span class="p">}</span>
        <span class="kd">val</span> <span class="py">lifecycle</span> <span class="p">=</span> <span class="n">fragment</span><span class="p">.</span><span class="n">viewLifecycleOwner</span><span class="p">.</span><span class="n">lifecycle</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">lifecycle</span><span class="p">.</span><span class="n">currentState</span><span class="p">.</span><span class="nf">isAtLeast</span><span class="p">(</span><span class="nc">Lifecycle</span><span class="p">.</span><span class="nc">State</span><span class="p">.</span><span class="nc">INITIALIZED</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Fragment views are destroyed."</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nf">viewBinder</span><span class="p">(</span><span class="n">thisRef</span><span class="p">.</span><span class="nf">requireView</span><span class="p">()).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">fragmentBinding</span> <span class="p">=</span> <span class="n">it</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>It’s kinda obnoxious to look at first, but let’s take a dive,</p><p>We have our Fragment again that’s holding the property, our viewBinder which accepts a View as a parameter and disposeEvents function (more on that later).</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nf">init</span> <span class="p">{</span>
    <span class="n">fragment</span><span class="p">.</span><span class="nf">observeLifecycleOwnerThroughLifecycleCreation</span> <span class="p">{</span>
        <span class="n">lifecycle</span><span class="p">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">this</span><span class="nd">@FragmentViewBindingDelegate</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="k">inline</span> <span class="k">fun</span> <span class="nc">Fragment</span><span class="p">.</span><span class="nf">observeLifecycleOwnerThroughLifecycleCreation</span><span class="p">(</span><span class="k">crossinline</span> <span class="n">viewOwner</span><span class="p">:</span> <span class="nc">LifecycleOwner</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">lifecycle</span><span class="p">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="kd">object</span> <span class="err">: </span><span class="nc">DefaultLifecycleObserver</span> <span class="p">{</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">owner</span><span class="p">:</span> <span class="nc">LifecycleOwner</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">viewLifecycleOwnerLiveData</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="nd">@observeLifecycleOwnerThroughLifecycleCreation</span><span class="p">,</span> <span class="nc">Observer</span> <span class="p">{</span> <span class="n">viewLifecycleOwner</span> <span class="p">-&gt;</span>
                <span class="n">viewLifecycleOwner</span><span class="p">.</span><span class="nf">viewOwner</span><span class="p">()</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">})</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We need to listen to the lifecycle somehow … we need to know when the viewLifecycle is created so that we can do our bindings, thankfully Fragments have</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">viewLifecycleOwnerLiveData</span>
</pre></table></code></div></div><p>which we can use to observe and provide lifecycle events we have to listen to the lifecycle onCreate event then and only then we know that we can observe viewLifecycleOwnerLiveData and take the observation result to add an observer (listen for events) to this delegate, FRAGMENTS ARE EASY.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">override</span> <span class="k">fun</span> <span class="nf">getValue</span><span class="p">(</span><span class="n">thisRef</span><span class="p">:</span> <span class="nc">Fragment</span><span class="p">,</span> <span class="n">property</span><span class="p">:</span> <span class="nc">KProperty</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
    <span class="nf">ensureMainThread</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">binding</span> <span class="p">=</span> <span class="n">fragmentBinding</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">binding</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">binding</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">lifecycle</span> <span class="p">=</span> <span class="n">fragment</span><span class="p">.</span><span class="n">viewLifecycleOwner</span><span class="p">.</span><span class="n">lifecycle</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">lifecycle</span><span class="p">.</span><span class="n">currentState</span><span class="p">.</span><span class="nf">isAtLeast</span><span class="p">(</span><span class="nc">Lifecycle</span><span class="p">.</span><span class="nc">State</span><span class="p">.</span><span class="nc">INITIALIZED</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Fragment views are destroyed."</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nf">viewBinder</span><span class="p">(</span><span class="n">thisRef</span><span class="p">.</span><span class="nf">requireView</span><span class="p">()).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">fragmentBinding</span> <span class="p">=</span> <span class="n">it</span> <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ensuring our views are accessed on the main thread, initializing the binding, checking what the lifecycle of our Fragment is, so that we can’t do any accessing when onDestroyView is called or onDestroy</p><p>and then where the magic happens is</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">return</span> <span class="nf">viewBinder</span><span class="p">(</span><span class="n">thisRef</span><span class="p">.</span><span class="nf">requireView</span><span class="p">()).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">fragmentBinding</span> <span class="p">=</span> <span class="n">it</span> <span class="p">}</span>
</pre></table></code></div></div><p>it takes our viewBinder function from the constructor, it gives it a parameter thisRef.requireView() which points to the Fragment that calls requireView(), which is the same as getView but it throws an exception that we have already solved with the lifecycle check and then .also allows us to set our fragmentBinding to the view that we just initialized and that’s T, in our case a type of View Binding that we set to our fragmentBinding variable.</p><p>But wait, there’s more.</p><p>You wanted to do dispose events, clean ups.</p><p>If you try <code class="language-plaintext highlighter-rouge">onDestroyView()</code> or <code class="language-plaintext highlighter-rouge">onDestroy()</code> you’ll get IllegalStateException that views are destroyed and you’ll think onPause and onStop are the perfect place to do disposes, they are but not quite your use case?</p><p>Hey, we got that case covered</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@OnLifecycleEvent</span><span class="p">(</span><span class="nc">Lifecycle</span><span class="p">.</span><span class="nc">Event</span><span class="p">.</span><span class="nc">ON_DESTROY</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">disposeBinding</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fragmentBinding</span><span class="o">?.</span><span class="nf">disposeEvents</span><span class="p">()</span>
    <span class="n">fragmentBinding</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">}</span>
</pre></table></code></div></div><p>before we dispose our Bindings we have the disposeEvents that are tied to the viewLifecycleOwner’s onDestroy event, so we can have something like this</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="kd">val</span> <span class="py">testFragmentBinding</span> <span class="k">by</span> <span class="nf">viewBinding</span><span class="p">(</span><span class="nc">TestFragmentBinding</span><span class="o">::</span><span class="n">bind</span><span class="p">){</span>
    <span class="c1">//do the dispose here</span>
    <span class="k">this</span><span class="p">.</span><span class="n">recyclerView</span><span class="p">.</span><span class="n">adapter</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and we would forget about even calling onDestroyView.</p><p>That’s it we made view binding easy to use, just go into your app’s build gradle and enable it.</p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">buildFeatures</span> <span class="o">{</span>
    <span class="n">viewBinding</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">}</span>
</pre></table></code></div></div><p>and/or include the library/helper I published to forget even copy/pasting the code from this post.</p><p>That’s it folks, View binding is now easy to work with, an elegant solution and replacement for synthetics which are soon to be deprecated and the nasty findViewById, no more deprecations huh, finally a good solution?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2/3.jpg" class="center" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=View binding for the lazy - FunkyMuse&url=https://funkymuse.github.io/posts/view-binding-for-the-lazy/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=View binding for the lazy - FunkyMuse&u=https://funkymuse.github.io/posts/view-binding-for-the-lazy/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=View binding for the lazy - FunkyMuse&url=https://funkymuse.github.io/posts/view-binding-for-the-lazy/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://funkymuse.github.io/posts/view-binding-for-the-lazy/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://www.reddit.com/submit?url=https://funkymuse.github.io/posts/view-binding-for-the-lazy/&title=View binding for the lazy - FunkyMuse" data-toggle="tooltip" data-placement="top" title="Reddit" target="_blank" rel="noopener" aria-label="Reddit"> <i class="fa-fw fab fa-reddit"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/dagger-part-5/"><div class="card-body"> <span class="timeago small" > Mar 29 <i class="unloaded">2021-03-29T22:45:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 5</h3><div class="text-muted small"><p> In the previous post we’ve explored scope operators. In this post we’ll encounter subcomponents and their hierarchy, custom scopes and let’s not waste any time. Starting off by including the an...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-6/"><div class="card-body"> <span class="timeago small" > Apr 2 <i class="unloaded">2021-04-02T20:05:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 6</h3><div class="text-muted small"><p> In the previous post we’ve encountered subcomponents and their hierarchy, custom scopes and we did not waste any time. In this post we’ll learn when’s the right place to inject, named and qualif...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-7/"><div class="card-body"> <span class="timeago small" > Apr 6 <i class="unloaded">2021-04-06T23:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 7</h3><div class="text-muted small"><p> In the previous post we’ve encountered when’s the right place to inject, named and qualifiers. In this post we’ll learn about multi bindings and their power. They’re your best buddies in the Da...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/optimize-build-gradle-speed/" class="btn btn-outline-primary" prompt="Older"><p>Optimize the build speed for your Android project</p></a> <a href="/posts/higher-order-functions/" class="btn btn-outline-primary" prompt="Newer"><p>Higher order functions, how, why and what not to do.</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/funky_muse">FunkyMuse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://funkymuse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
