<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Hilt to the rescue, part 2" /><meta name="author" content="FunkyMuse" /><meta property="og:locale" content="en_US" /><meta name="description" content="Blog containing Kotlin and Android goodies." /><meta property="og:description" content="Blog containing Kotlin and Android goodies." /><link rel="canonical" href="https://funkymuse.github.io/posts/hilt-part-2/" /><meta property="og:url" content="https://funkymuse.github.io/posts/hilt-part-2/" /><meta property="og:site_name" content="FunkyMuse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-06T11:55:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hilt to the rescue, part 2" /><meta name="twitter:site" content="@funky_muse" /><meta name="twitter:creator" content="@FunkyMuse" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"FunkyMuse"},"description":"Blog containing Kotlin and Android goodies.","url":"https://funkymuse.github.io/posts/hilt-part-2/","@type":"BlogPosting","headline":"Hilt to the rescue, part 2","dateModified":"2021-06-06T11:55:00+02:00","datePublished":"2021-06-06T11:55:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://funkymuse.github.io/posts/hilt-part-2/"},"@context":"https://schema.org"}</script><title>Hilt to the rescue, part 2 | FunkyMuse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">FunkyMuse</a></div><div class="site-subtitle font-italic">Anything which inspires everything</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/apps/" class="nav-link"> <i class="fa-fw fas fa-mobile ml-xl-3 mr-xl-3 unloaded"></i> <span>APPLICATIONS</span> </a><li class="nav-item"> <a href="/hire_me/" class="nav-link"> <i class="fa-fw fas fa-code ml-xl-3 mr-xl-3 unloaded"></i> <span>HIRE ME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/FunkyMuse" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/funky_muse" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['funkymuse','protonmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Hilt to the rescue, part 2</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hilt to the rescue, part 2</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> FunkyMuse </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 6, 2021, 11:55 AM +0200" prep="on" > Jun 6 <i class="unloaded">2021-06-06T11:55:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1369 words">7 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/hilt/1/hilt_1.jpg" class="center" /></p><p>In the previous post <a href="/posts/hilt-part-1/">Part #1</a>, we’ve explored how to set up Hilt, the pre-defined components that come with it and migrated to Hilt from our Dagger sample.</p><p>In this blog post we’ll explore how to have our custom component live inside the Hilt hierarchy.</p><h2 id="custom-components-information">Custom components information</h2><hr /><p>The <a href="https://dagger.dev/hilt/custom-components.html">documentation</a> for custom components is bland, but does ask the most important question, Is a custom component needed?</p><p>In our case yes, but it does has some drawbacks</p><ul><li>Each component/scope adds cognitive overhead.<li>They can complicate the graph with combinatorics (e.g. if the component is a child of the ViewComponent conceptually, two components likely need to be added for ViewComponent and ViewWithFragmentComponent).<li>Components can have only one parent. The component hierarchy can’t form a diamond. Creating more components increases the likelihood of getting into a situation where a diamond dependency is needed. Unfortunately, there is no good solution to this diamond problem and it can be difficult to predict and avoid.<li>Custom components work against standardization. The more custom components are used, the harder it is for shared libraries.</ul><p>With those in mind, these are some criteria you should use for deciding if a custom component is needed:</p><ul><li>The component has a well-defined lifetime associated with it.<li>The concept of the component is well-understood and widely applicable. Hilt components are global to the app so the concepts should be applicable everywhere. Being globally understood also combats some of the issues with cognitive overhead.<li>Consider if a non-Hilt (regular Dagger) component is sufficient. For components with a limited purpose sometimes it is better to use a non-Hilt component. For example, consider a production component that represents a single background task. Hilt components excel in situations where code needs to be contributed from possibly disjoint/modular code. If your component isn’t really meant to be extensible, it may not be a good match for a Hilt custom component.</ul><h2 id="custom-components-restrictions">Custom components restrictions</h2><hr /><ul><li>Components must be a direct or indirect child of the SingletonComponent.<li>Components may not be inserted between any of the standard components. For example, a component cannot be added between the ActivityComponent and the FragmentComponent.</ul><h2 id="creating-a-custom-component">Creating a custom component</h2><hr /><p>For this demonstration, we are having user management use case, for that sake let’s create a simple <code class="language-plaintext highlighter-rouge">User</code> class</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">data class</span> <span class="nc">User</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">surname</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span>
</pre></table></code></div></div><p>and let’s define a contract upon which we’ll be building our user management</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">interface</span> <span class="nc">UserManagerContract</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">userID</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span>
    <span class="kd">val</span> <span class="py">isUserLoggedIn</span><span class="p">:</span> <span class="nc">Boolean</span>

    <span class="k">fun</span> <span class="nf">logIn</span><span class="p">(</span><span class="n">loggedInUser</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">logOut</span><span class="p">()</span>
    <span class="k">fun</span> <span class="nf">changeUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span>

<span class="p">}</span>
</pre></table></code></div></div><p>In order to have our custom component, let’s define our own custom scope</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@Scope</span>
<span class="nd">@Retention</span>
<span class="k">annotation</span> <span class="kd">class</span> <span class="nc">LoggedInUserScope</span>
</pre></table></code></div></div><p>As with the Dagger series you’ve already know the building blocks of a component, which consists of</p><ol><li>The component itself<li>Factory/builder<li>Scope</ol><p>Since Hilt already has a hierarchy we’ll need another building block (4th in our list) which is an Entry Point.</p><ul><li>Entry point</ul><h3 id="what-is-an-entry-point">What is an Entry point?</h3><hr /><p>An entry point tells which component/s should have an entry point, which essentially means that whenever the components are assembled by Hilt then and only then Hilt will know which components to include, as we’ve understood from the limitations of Hilt, every custom component we create is actually a sub-component of those pre-defined Hilt components, which then translates that every custom component that we create (sub-component) must have an <em>Entry point</em> accessor in order for us to get an instance of it.</p><h3 id="definecomponent">DefineComponent</h3><hr /><p>Every custom component must be annotated with <code class="language-plaintext highlighter-rouge">@DefineComponent</code>, this annotation has a parent parameter which you must include</p><p>our custom component will look like this</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@DefineComponent</span><span class="p">(</span><span class="n">parent</span> <span class="p">=</span> <span class="nc">SingletonComponent</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="nd">@LoggedInUserScope</span>
<span class="kd">interface</span> <span class="nc">LoggedInUserComponent</span> 
</pre></table></code></div></div><h3 id="definecomponentbuilder">DefineComponent.Builder</h3><hr /><p>The builder for a component must be annotated with, probably you know already</p><p><code class="language-plaintext highlighter-rouge">@DefineComponent.Builder</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@DefineComponent</span><span class="p">.</span><span class="nc">Builder</span>
    <span class="kd">interface</span> <span class="nc">Builder</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">provideUser</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">):</span> <span class="nc">Builder</span>
        <span class="k">fun</span> <span class="nf">build</span><span class="p">():</span> <span class="nc">LoggedInUserComponent</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>As a standard Dagger2 builder, we’re binding an instance and returning the builder, then our build function has the duty to build the component.</p><p>I wish they had <code class="language-plaintext highlighter-rouge">@DefineComponent.Factory</code> so that we won’t need this <code class="language-plaintext highlighter-rouge">fun build()</code> function.</p><p>All in all, we’ll end up having our <code class="language-plaintext highlighter-rouge">LoggedInUserComponent</code> looking like</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@DefineComponent</span><span class="p">(</span><span class="n">parent</span> <span class="p">=</span> <span class="nc">SingletonComponent</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="nd">@LoggedInUserScope</span>
<span class="kd">interface</span> <span class="nc">LoggedInUserComponent</span> <span class="p">{</span>

    <span class="nd">@DefineComponent</span><span class="p">.</span><span class="nc">Builder</span>
    <span class="kd">interface</span> <span class="nc">Builder</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">provideUser</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">):</span> <span class="nc">Builder</span>
        <span class="k">fun</span> <span class="nf">build</span><span class="p">():</span> <span class="nc">LoggedInUserComponent</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><h3 id="entry-point">Entry point</h3><hr /><p>Whenever we annotate our custom made entry point with <code class="language-plaintext highlighter-rouge">@EntryPoint</code> we must tell Hilt in which component we must have it installed, in our case we made our own <code class="language-plaintext highlighter-rouge">LoggedInUserComponent</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@EntryPoint</span>
<span class="nd">@InstallIn</span><span class="p">(</span><span class="nc">LoggedInUserComponent</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">interface</span> <span class="nc">LoggedInUserEntryPoint</span> <span class="p">{</span>
    <span class="k">fun</span> <span class="nf">provideUserRepository</span><span class="p">():</span> <span class="nc">UserRepository</span>
<span class="p">}</span>
</pre></table></code></div></div><p>inside we’re providing only one dependency (which we’ll create in a bit).</p><h2 id="userrepository">UserRepository</h2><p>Our <code class="language-plaintext highlighter-rouge">UserRepository</code> will be implementing the contract we’ve created early <code class="language-plaintext highlighter-rouge">UserManagerContract</code> and we have to scope it to our custom scope <code class="language-plaintext highlighter-rouge">@LoggedInUserScope</code>.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nd">@LoggedInUserScope</span>
<span class="kd">class</span> <span class="nc">UserRepository</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">userManager</span><span class="p">:</span> <span class="nc">UserManager</span><span class="p">)</span> <span class="p">:</span>
    <span class="nc">UserManagerContract</span>  <span class="p">{</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">userID</span><span class="p">:</span> <span class="nc">Int</span><span class="p">?</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">userManager</span><span class="p">.</span><span class="n">user</span><span class="o">?.</span><span class="n">id</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">isUserLoggedIn</span><span class="p">:</span> <span class="nc">Boolean</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">userID</span> <span class="p">!=</span> <span class="k">null</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">logIn</span><span class="p">(</span><span class="n">loggedInUser</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">userManager</span><span class="p">.</span><span class="nf">logIn</span><span class="p">(</span><span class="n">loggedInUser</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">logOut</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">userManager</span><span class="p">.</span><span class="nf">logOut</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">changeUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">userManager</span><span class="p">.</span><span class="nf">changeUser</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The repository only delegates most of the duty to our <code class="language-plaintext highlighter-rouge">UserManager</code>.</p><h2 id="usermanager">UserManager</h2><p>In our <code class="language-plaintext highlighter-rouge">UserManager</code> we need an instance of our <code class="language-plaintext highlighter-rouge">LoggedInUserComponent</code> and manage it’s lifecycle.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="nd">@Singleton</span>
<span class="kd">class</span> <span class="nc">UserManager</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">loggedInUserProvider</span><span class="p">:</span> <span class="nc">Provider</span><span class="p">&lt;</span><span class="nc">LoggedInUserComponent</span><span class="err">.</span><span class="nc">Builder</span><span class="p">&gt;</span>
<span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="py">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
        <span class="k">private</span> <span class="k">set</span>

    <span class="kd">var</span> <span class="py">userComponent</span><span class="p">:</span> <span class="nc">LoggedInUserComponent</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
        <span class="k">private</span> <span class="k">set</span>

    <span class="c1">//we pretend that we're getting this User model from the backend    </span>
    <span class="k">fun</span> <span class="nf">logIn</span><span class="p">(</span><span class="n">loggedInUser</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// When the user logs in, we create a new instance of LoggedInUserComponent</span>
        <span class="n">userComponent</span> <span class="p">=</span> <span class="n">loggedInUserProvider</span><span class="p">.</span><span class="k">get</span><span class="p">().</span><span class="nf">provideUser</span><span class="p">(</span><span class="n">loggedInUser</span><span class="p">).</span><span class="nf">build</span><span class="p">()</span>
        <span class="n">user</span> <span class="p">=</span> <span class="n">loggedInUser</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">changeUser</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="nc">User</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">logOut</span><span class="p">()</span>
        <span class="nf">logIn</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">logOut</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">userComponent</span> <span class="p">=</span> <span class="k">null</span>
        <span class="n">user</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>Since our <code class="language-plaintext highlighter-rouge">UserManager</code> will be available in our <code class="language-plaintext highlighter-rouge">LoginFragment</code> or <code class="language-plaintext highlighter-rouge">LoginActivity</code> we need it as a singleton, but the only thing that’s prone to change is our component and it’s lifecycle.</p><p>We’re using a provider since we only need to create the instance whenever there’s a <code class="language-plaintext highlighter-rouge">logIn</code> event.</p><p>Let’s go on and simulate our Log in scenario.</p><h2 id="log-in-scenario">Log in scenario</h2><p>For the brevity of this post, we keep the scenario inside one activity, but ideally you should do this from a LoginFragment or Activity</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="nd">@Inject</span>
    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">userManager</span><span class="p">:</span> <span class="nc">UserManager</span>

    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">userRepository</span><span class="p">:</span> <span class="nc">UserRepository</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="nf">setContentView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>

        <span class="c1">//we're simulating login, this would happen from LoginFragment or LoginActivity, for the sake of brevity we have it here</span>
        <span class="n">userManager</span><span class="p">.</span><span class="nf">logIn</span><span class="p">(</span><span class="nc">User</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"test"</span><span class="p">,</span> <span class="n">surname</span> <span class="p">=</span> <span class="s">"test"</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1">//initializing the user repository wherever we need it after user is logged in</span>
        <span class="n">userRepository</span> <span class="p">=</span> <span class="nc">EntryPoints</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">userManager</span><span class="p">.</span><span class="n">userComponent</span><span class="p">,</span> <span class="nc">LoggedInUserEntryPoint</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">).</span><span class="nf">provideUserRepository</span><span class="p">()</span>


        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"USER ID"</span><span class="p">,</span> <span class="n">userRepository</span><span class="p">.</span><span class="n">userID</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
        <span class="n">lifecycleScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="nf">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
            <span class="n">userRepository</span><span class="p">.</span><span class="nf">changeUser</span><span class="p">(</span><span class="nc">User</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"test"</span><span class="p">,</span> <span class="n">surname</span> <span class="p">=</span> <span class="s">"test"</span><span class="p">,</span> <span class="n">id</span> <span class="p">=</span> <span class="mi">2</span><span class="p">))</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="s">"USER ID"</span><span class="p">,</span> <span class="n">userRepository</span><span class="p">.</span><span class="n">userID</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>the most important piece of code here is</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">EntryPoints</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">userManager</span><span class="p">.</span><span class="n">userComponent</span><span class="p">,</span> <span class="nc">LoggedInUserEntryPoint</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
</pre></table></code></div></div><p>What it does is, it generates our custom <em>Entry point</em> (<code class="language-plaintext highlighter-rouge">LoggedInUserEntryPoint</code>), every <code class="language-plaintext highlighter-rouge">EntryPoint</code> depends on the custom component that you create.</p><p>Once that piece of code executes you have an instance of <code class="language-plaintext highlighter-rouge">LoggedInUserEntryPoint</code> which holds the dependency you need, in our case <code class="language-plaintext highlighter-rouge">UserRepository</code>.</p><p>What we’re doing above is, we’re logging the user and after that 1 second delay we’re changing the user.</p><p>After we launch the application</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/hilt/2/1.png" class="center" /></p><p>It worked.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/hilt/2/component.jpeg" class="center" /></p><h2 id="scenario-information">Scenario information</h2><p><strong><em>Do note that you’ll be needing events to handle log-in and log-out events, usually navigating user and restricting access, this is just a guide, not a full solution</em></strong></p><h2 id="closing-notes">Closing notes</h2><p>This does seem a bit painful to manage a lot of these custom components, but if you split every management into a separate module, it’s managable.</p><p>Untill next part where we look at how to use Hilt in multi-module project + assisted inject.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/hilt/2/di.jpeg" class="center" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hilt/'>Hilt</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hilt/" class="post-tag no-text-decoration" >Hilt</a> <a href="/tags/kotlin/" class="post-tag no-text-decoration" >Kotlin</a> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hilt to the rescue, part 2 - FunkyMuse&url=https://funkymuse.github.io/posts/hilt-part-2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hilt to the rescue, part 2 - FunkyMuse&u=https://funkymuse.github.io/posts/hilt-part-2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hilt to the rescue, part 2 - FunkyMuse&url=https://funkymuse.github.io/posts/hilt-part-2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://funkymuse.github.io/posts/hilt-part-2/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://www.reddit.com/submit?url=https://funkymuse.github.io/posts/hilt-part-2/&title=Hilt to the rescue, part 2 - FunkyMuse" data-toggle="tooltip" data-placement="top" title="Reddit" target="_blank" rel="noopener" aria-label="Reddit"> <i class="fa-fw fab fa-reddit"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hilt-part-1/"><div class="card-body"> <span class="timeago small" > May 17 <i class="unloaded">2021-05-17T18:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hilt to the rescue, part 1</h3><div class="text-muted small"><p> Hilt is a dependency injection library for Android that reduces the boilerplate of doing manual dependency injection in your project, it also means that Hilt is just an abstraction on top of Dagg...</p></div></div></a></div><div class="card"> <a href="/posts/compose_hilt_mm/"><div class="card-body"> <span class="timeago small" > Jul 4 <i class="unloaded">2021-07-04T11:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Navigation in multi module Android Compose UI project + Hilt</h3><div class="text-muted small"><p> If you’ve written an Android application you must have had some form of navigation inside your project, whether that’s manually starting Activities or managing Fragment transactions on your own (...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-5/"><div class="card-body"> <span class="timeago small" > Mar 29 <i class="unloaded">2021-03-29T22:45:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 5</h3><div class="text-muted small"><p> In the previous post we’ve explored scope operators. In this post we’ll encounter subcomponents and their hierarchy, custom scopes and let’s not waste any time. Starting off by including the an...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/hilt-part-1/" class="btn btn-outline-primary" prompt="Older"><p>Hilt to the rescue, part 1</p></a> <a href="/posts/compose_hilt_mm/" class="btn btn-outline-primary" prompt="Newer"><p>Navigation in multi module Android Compose UI project + Hilt</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/funky_muse">FunkyMuse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://funkymuse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
