<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Navigation in multi module Android Compose UI project + Hilt" /><meta name="author" content="FunkyMuse" /><meta property="og:locale" content="en_US" /><meta name="description" content="Blog containing Kotlin and Android goodies." /><meta property="og:description" content="Blog containing Kotlin and Android goodies." /><link rel="canonical" href="https://funkymuse.github.io/posts/compose_hilt_mm/" /><meta property="og:url" content="https://funkymuse.github.io/posts/compose_hilt_mm/" /><meta property="og:site_name" content="FunkyMuse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-04T11:55:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Navigation in multi module Android Compose UI project + Hilt" /><meta name="twitter:site" content="@funky_muse" /><meta name="twitter:creator" content="@FunkyMuse" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"FunkyMuse"},"description":"Blog containing Kotlin and Android goodies.","url":"https://funkymuse.github.io/posts/compose_hilt_mm/","@type":"BlogPosting","headline":"Navigation in multi module Android Compose UI project + Hilt","dateModified":"2021-07-04T11:55:00+02:00","datePublished":"2021-07-04T11:55:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://funkymuse.github.io/posts/compose_hilt_mm/"},"@context":"https://schema.org"}</script><title>Navigation in multi module Android Compose UI project + Hilt | FunkyMuse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">FunkyMuse</a></div><div class="site-subtitle font-italic">Anything which inspires everything</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/apps/" class="nav-link"> <i class="fa-fw fas fa-mobile ml-xl-3 mr-xl-3 unloaded"></i> <span>APPLICATIONS</span> </a><li class="nav-item"> <a href="/hire_me/" class="nav-link"> <i class="fa-fw fas fa-code ml-xl-3 mr-xl-3 unloaded"></i> <span>HIRE ME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/FunkyMuse" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/funky_muse" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['funkymuse','protonmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Navigation in multi module Android Compose UI project + Hilt</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Navigation in multi module Android Compose UI project + Hilt</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> FunkyMuse </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 4, 2021, 11:55 AM +0200" prep="on" > Jul 4 <i class="unloaded">2021-07-04T11:55:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1620 words">9 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/header.png" class="center" /></p><p>If you’ve written an Android application you must have had some form of navigation inside your project, whether that’s manually starting Activities or managing Fragment transactions on your own (hopefully you didn’t have to do this) or using navigation component, this is an article for you.</p><p>As you know Google released a terribly named UI toolking that’s just basically a compiler plugin on top of Kotlin to build Android UI, for more information about this read Jake’s <a href="https://jakewharton.com/a-jetpack-compose-by-any-other-name/">blogpost</a>.</p><h2 id="shortcomings-of-navigation-compose">Shortcomings of Navigation-compose</h2><hr /><p>Google also released navigation component for Compose and it has it’s shortcomings, especially with multi modular applications.</p><h3 id="why">Why?</h3><p>You need to use the navigation controller to navigate to a destination, this produces</p><ol><li>NavHostController reference in Composable functions<ul><li>We need the instance produced by <code class="language-plaintext highlighter-rouge">rememberNavController</code> in order to navigate somewhere.<li>This instance won’t allow us to easily test navigation as it does make us reliant on the instance provided either as a function parameter or a LocalProvider which both can be shooting yourself in the foot</ul><li>Easier testing<ul><li>As Mentioned in #1</ul><li>Modularization approach<ul><li>In order for you to navigate to a destination, using the navController will require you to have inclusion of the navigation dependency, which won’t make sense to use in a multi module project.<li>The destination doesn’t have to know about the UI, it can be separated from the logic as well, since in compose we only navigate through routes built of <code class="language-plaintext highlighter-rouge">String</code>s.<li>Going back from current destination requires also the <code class="language-plaintext highlighter-rouge">navController</code> instance just to call <code class="language-plaintext highlighter-rouge">navigateUp</code> which is painful when you might only need this, imagine navigating to a details screen and there you only have a back button, adding the whole navigation controller instance doesn’t make much sense.<li>Reusability, let’s say you want to go from A &gt; B, B &gt; C, C &gt; D, D &gt; B, the problem arises when going from D &gt; B, in our approach D can include the navigation logic and know how to get to B, same as A, by just re-using the navigation routes we’ll make our lives easier.</ul></ol><p>There are probably more whys, I just haven’t got to them yet.</p><h2 id="building-our-navigation-module">Building our navigation module</h2><hr /><p>Every destination has two things in common.</p><ol><li><strong>Route</strong><li><strong><em>Arguments</em></strong></ol><p>For that matter we create our contract</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">interface</span> <span class="nc">NavigationDestination</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">route</span><span class="p">():</span> <span class="nc">String</span>
    <span class="kd">val</span> <span class="py">arguments</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">NamedNavArgument</span><span class="p">&gt;</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="nf">emptyList</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p>You might ask yourself, why’s this a functional interface?</p><p>Sometimes you might never add arguments, for example your app provide crash reports on your own, your user can navigate from Settings &gt; Crash reports, for that case we have a default for our arguments and the route has to be included every time.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/1.png" class="center" /></p><p>The other building block we need is the events, every app has a navigate to and navigate from, of course this doesn’t stop you to add more events as they can be tailored to your use case, these are the most commonly used, for that purpose we have our Navigator</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kd">interface</span> <span class="nc">Navigator</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">navigateUp</span><span class="p">():</span> <span class="nc">Boolean</span>
    <span class="k">fun</span> <span class="nf">navigate</span><span class="p">(</span><span class="n">route</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="nc">NavOptionsBuilder</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span> <span class="p">=</span> <span class="p">{</span> <span class="n">launchSingleTop</span> <span class="p">=</span> <span class="k">true</span> <span class="p">}):</span> <span class="nc">Boolean</span>
    <span class="kd">val</span> <span class="py">destinations</span><span class="p">:</span> <span class="nc">Channel</span><span class="p">&lt;</span><span class="nc">NavigatorEvent</span><span class="p">&gt;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The most confusing part here is the <code class="language-plaintext highlighter-rouge">{ launchSingleTop = true }</code>, since we mostly need only one instance at a time when navigating to a composable screen, that’s the default for the <code class="language-plaintext highlighter-rouge">NavOptionsBuilder</code> since we are leveraging the following function from the navigation controller, you can tailor to your own one it doesn’t matter, consider this as it should be your guide towards your own use case.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>    <span class="cm">/**
     * Navigate to a route in the current NavGraph. If an invalid route is given, an
     * [IllegalArgumentException] will be thrown.
     *
     * @param route route for the destination
     * @param builder DSL for constructing a new [NavOptions]
     *
     * @throws IllegalArgumentException if the given route is invalid
     */</span>
    <span class="k">public</span> <span class="k">fun</span> <span class="nf">navigate</span><span class="p">(</span><span class="n">route</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="nc">NavOptionsBuilder</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">navigate</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="nf">navOptions</span><span class="p">(</span><span class="n">builder</span><span class="p">))</span>
    <span class="p">}</span>

</pre></table></code></div></div><p>We need events for the navigator, sealed classes are our best friends here</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">sealed</span> <span class="kd">class</span> <span class="nc">NavigatorEvent</span> <span class="p">{</span>
    <span class="kd">object</span> <span class="nc">NavigateUp</span> <span class="p">:</span> <span class="nc">NavigatorEvent</span><span class="p">()</span>
    <span class="kd">class</span> <span class="nc">Directions</span><span class="p">(</span><span class="kd">val</span> <span class="py">destination</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">builder</span><span class="p">:</span> <span class="nc">NavOptionsBuilder</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">:</span> <span class="nc">NavigatorEvent</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and we also need something to handles our events, with the help of <code class="language-plaintext highlighter-rouge">Hilt</code> as we tend to reuse this we have to implement our navigator</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Singleton</span>
<span class="k">internal</span> <span class="kd">class</span> <span class="nc">NavigatorImpl</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">()</span> <span class="p">:</span> <span class="nc">Navigator</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">navigationEvents</span> <span class="p">=</span> <span class="nc">Channel</span><span class="p">&lt;</span><span class="nc">NavigatorEvent</span><span class="p">&gt;()</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">destinations</span> <span class="p">=</span> <span class="n">navigationEvents</span><span class="p">.</span><span class="nf">receiveAsFlow</span><span class="p">()</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">navigateUp</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">navigationEvents</span><span class="p">.</span><span class="nf">trySend</span><span class="p">(</span><span class="nc">NavigatorEvent</span><span class="p">.</span><span class="nc">NavigateUp</span><span class="p">).</span><span class="n">isSuccess</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">navigate</span><span class="p">(</span><span class="n">route</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="nc">NavOptionsBuilder</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">navigationEvents</span><span class="p">.</span><span class="nf">trySend</span><span class="p">(</span><span class="nc">NavigatorEvent</span><span class="p">.</span><span class="nc">Directions</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">builder</span><span class="p">)).</span><span class="n">isSuccess</span>

<span class="p">}</span>
</pre></table></code></div></div><p>in our <code class="language-plaintext highlighter-rouge">NavigatorImpl</code> we mimick the <code class="language-plaintext highlighter-rouge">navController</code> navigate and navigateUp functions but built on coroutines to try and handle successful navigations or not with the boolean callback but relying on the channel’s implementation for that, trySend doesn’t block, you can have the navigateUp as a suspend function in order to have more granular control of the <code class="language-plaintext highlighter-rouge">Job</code> returned but I didn’t see any need for that.</p><p>Sweet <code class="language-plaintext highlighter-rouge">Hilt</code> helps us with exposing the <code class="language-plaintext highlighter-rouge">Navigator</code> only while keeping the implementation internal to the module as you might have noticed <code class="language-plaintext highlighter-rouge">NavigatorImpl</code> has internal modifier.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">@Module</span>
<span class="nd">@InstallIn</span><span class="p">(</span><span class="nc">SingletonComponent</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="k">internal</span> <span class="k">abstract</span> <span class="kd">class</span> <span class="nc">NavigatorModule</span> <span class="p">{</span>

    <span class="nd">@Binds</span>
    <span class="k">abstract</span> <span class="k">fun</span> <span class="nf">navigator</span><span class="p">(</span><span class="n">navigator</span><span class="p">:</span> <span class="nc">NavigatorImpl</span><span class="p">):</span> <span class="nc">Navigator</span>
<span class="p">}</span>
</pre></table></code></div></div><p>That’s not all, since we already build our module sometimes we might only need navigation logic, but we can’t get that with <code class="language-plaintext highlighter-rouge">Hilt</code> inside a composable without creating an <code class="language-plaintext highlighter-rouge">EntryPoint</code> which will look like a boilerplate but we can do the following</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@HiltViewModel</span>
<span class="kd">class</span> <span class="nc">NavigatorViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
        <span class="k">private</span> <span class="kd">val</span> <span class="py">navigator</span><span class="p">:</span> <span class="nc">Navigator</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">(),</span> <span class="nc">Navigator</span> <span class="k">by</span> <span class="n">navigator</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Navigator</code> has the necessary elements for navigating and we can delegate them to this <code class="language-plaintext highlighter-rouge">ViewModel</code> which will be our navigator mechanism within the composable, we can end up having a logic where we only need navigation to destinations without any other logic and we can use the <code class="language-plaintext highlighter-rouge">NavigatorViewModel</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/3.png" class="center" /></p><p>or we can have it injected into a view model (as the picture above) wherever we need the functionality for later on (pictures below)</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/4.png" class="center" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/5.png" class="center" /></p><p>The navigation destination is really simple, but yet confusing</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">object</span> <span class="nc">BookDetailsDestination</span> <span class="p">:</span> <span class="nc">NavigationDestination</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">route</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="nc">BOOK_DETAILS_BOTTOM_NAV_ROUTE</span>

    <span class="k">override</span> <span class="kd">val</span> <span class="py">arguments</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">NamedNavArgument</span><span class="p">&gt;</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="nf">navArgument</span><span class="p">(</span><span class="nc">BOOK_ID_PARAM</span><span class="p">)</span> <span class="p">{</span> <span class="n">type</span> <span class="p">=</span> <span class="nc">NavType</span><span class="p">.</span><span class="nc">IntType</span> <span class="p">})</span>

    <span class="k">const</span> <span class="kd">val</span> <span class="py">BOOK_ID_PARAM</span> <span class="p">=</span> <span class="s">"book"</span>

    <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">BOOK_DETAILS_ROUTE</span> <span class="p">=</span> <span class="s">"book_details"</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">BOOK_DETAILS_BOTTOM_NAV_ROUTE</span> <span class="p">=</span> <span class="s">"$BOOK_DETAILS_ROUTE/{$BOOK_ID_PARAM}"</span>
    <span class="k">fun</span> <span class="nf">createBookDetailsRoute</span><span class="p">(</span><span class="n">bookID</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">=</span> <span class="s">"$BOOK_DETAILS_ROUTE/${bookID}"</span>

<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">BookDetailsDestination</code> holds our navigation route and arguments for the <code class="language-plaintext highlighter-rouge">NavGraph</code>, we add this so that the graph knows about this destination, this is separate from our <code class="language-plaintext highlighter-rouge">createBookDetailsRoute</code> that creates the route to navigate to the destination which we need to pass to our <code class="language-plaintext highlighter-rouge">Navigator.navigate(route:String)</code> in order to execute the navigation.</p><p>In order to wire the whole navigation we only need this included in the app level where we set up our navigation</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/6.png" class="center" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/7.png" class="center" /></p><p>Our navigation module end up looking really short</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/8.png" class="center" /></p><h2 id="structuring-our-application">Structuring our application</h2><hr /><p>Taking care of the navigation is the easy part, the next challenge is structuring the project.</p><p>The approach I took for a client (due to NDAs i’m not supposed to reveal the app, it’s fitness related app), that now i’m using for a pet project, scaled pretty well, there were ~50 screens and everything was separated, every feature was a folder module, within that module there’s</p><ol><li><strong>Data module</strong> -&gt; Which loads the data and exposes it through a view model, can have the navigation as a delegate so that we don’t include the navigator with a separate <code class="language-plaintext highlighter-rouge">ViewModel</code> or doesn’t have to if it doesn’t have to then your UI would need to include the navigator, whichever approach I took I ended up delegating the navigator to the data module inside the ViewModel<li><strong>UI module</strong> -&gt; Has only the UI part which uses the data module<li><strong>Destination module</strong> -&gt; has the logic to navigate to the screen<li><strong>Model module</strong> -&gt; has the necessary models that will be included in our Data module (#1)</ol><p><em>Do note that the naming doesn’t really matter, some might use: business logic/layer etc etc.. that’s up for discussion internally in your team or however you feel like.</em></p><p>Your project will look like this or you might add another layer in between that creates a database <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/9.png" class="center" /></p><p>You might think, we’re creating a lot of modules, yes we are, we’re creating reusable parts that we can easily test and plug-in, plug-out or replace whenever we need to, some argue that good architecture is expensive, but have you tried bad architecture?</p><p>Compose UI enables us to hoist everything up to the top function and we can have everything as it’s own component, unreliant on anything else, uncoupled and does only it’s own thing.</p><p>For example a confirmation dialog</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/nav_mm_hilt/10.png" class="center" /></p><p>You can check out this approach in my pet <a href="https://github.com/FunkyMuse/Aurora">project</a>.</p><p><em>Also there’s another UI approach I took, not as mentioned in the project (as this project only has a small part of the UI modularized), which had the design, colors, styles, themes separated, as well as a building component for buttons, titles, subtitles etc.. but it’s not mentioned here as the UI parts for compose will change in the future and there will be better “best” practices, at the moment that’s how I saw it fit to modularize every single part of the UI as well, but this small pet project can’t really shine in that way, unless it grows in the future.</em></p><p>Thank you for reading and I hope you learnt something new.</p><p>Don’t forget to subscribe to the RSS feed in order to get updates for future posts.</p><p>Stay safe!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hilt/'>Hilt</a>, <a href='/categories/compose/'>Compose</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/hilt/" class="post-tag no-text-decoration" >Hilt</a> <a href="/tags/kotlin/" class="post-tag no-text-decoration" >Kotlin</a> <a href="/tags/compose/" class="post-tag no-text-decoration" >Compose</a> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Navigation in multi module Android Compose UI project + Hilt - FunkyMuse&url=https://funkymuse.github.io/posts/compose_hilt_mm/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Navigation in multi module Android Compose UI project + Hilt - FunkyMuse&u=https://funkymuse.github.io/posts/compose_hilt_mm/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Navigation in multi module Android Compose UI project + Hilt - FunkyMuse&url=https://funkymuse.github.io/posts/compose_hilt_mm/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://funkymuse.github.io/posts/compose_hilt_mm/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://www.reddit.com/submit?url=https://funkymuse.github.io/posts/compose_hilt_mm/&title=Navigation in multi module Android Compose UI project + Hilt - FunkyMuse" data-toggle="tooltip" data-placement="top" title="Reddit" target="_blank" rel="noopener" aria-label="Reddit"> <i class="fa-fw fab fa-reddit"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hilt-part-1/"><div class="card-body"> <span class="timeago small" > May 17 <i class="unloaded">2021-05-17T18:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hilt to the rescue, part 1</h3><div class="text-muted small"><p> Hilt is a dependency injection library for Android that reduces the boilerplate of doing manual dependency injection in your project, it also means that Hilt is just an abstraction on top of Dagg...</p></div></div></a></div><div class="card"> <a href="/posts/hilt-part-2/"><div class="card-body"> <span class="timeago small" > Jun 6 <i class="unloaded">2021-06-06T11:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hilt to the rescue, part 2</h3><div class="text-muted small"><p> In the previous post Part #1, we’ve explored how to set up Hilt, the pre-defined components that come with it and migrated to Hilt from our Dagger sample. In this blog post we’ll explore how to ...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-5/"><div class="card-body"> <span class="timeago small" > Mar 29 <i class="unloaded">2021-03-29T22:45:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 5</h3><div class="text-muted small"><p> In the previous post we’ve explored scope operators. In this post we’ll encounter subcomponents and their hierarchy, custom scopes and let’s not waste any time. Starting off by including the an...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/hilt-part-2/" class="btn btn-outline-primary" prompt="Older"><p>Hilt to the rescue, part 2</p></a> <a href="/posts/gradle_abstraction/" class="btn btn-outline-primary" prompt="Newer"><p>Gradle peace in multi module projects</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/funky_muse">FunkyMuse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://funkymuse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
