<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="How long will you go to protect your Android app from being tampered?" /><meta name="author" content="FunkyMuse" /><meta property="og:locale" content="en_US" /><meta name="description" content="Blog containing Kotlin and Android goodies." /><meta property="og:description" content="Blog containing Kotlin and Android goodies." /><link rel="canonical" href="https://funkymuse.github.io/posts/android_anti_tampering/" /><meta property="og:url" content="https://funkymuse.github.io/posts/android_anti_tampering/" /><meta property="og:site_name" content="FunkyMuse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-07-11T16:30:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How long will you go to protect your Android app from being tampered?" /><meta name="twitter:site" content="@funky_muse" /><meta name="twitter:creator" content="@FunkyMuse" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"FunkyMuse"},"description":"Blog containing Kotlin and Android goodies.","url":"https://funkymuse.github.io/posts/android_anti_tampering/","@type":"BlogPosting","headline":"How long will you go to protect your Android app from being tampered?","dateModified":"2021-07-11T16:30:00+02:00","datePublished":"2021-07-11T16:30:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://funkymuse.github.io/posts/android_anti_tampering/"},"@context":"https://schema.org"}</script><title>How long will you go to protect your Android app from being tampered? | FunkyMuse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">FunkyMuse</a></div><div class="site-subtitle font-italic">Anything which inspires everything</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/apps/" class="nav-link"> <i class="fa-fw fas fa-mobile ml-xl-3 mr-xl-3 unloaded"></i> <span>APPLICATIONS</span> </a><li class="nav-item"> <a href="/hire_me/" class="nav-link"> <i class="fa-fw fas fa-code ml-xl-3 mr-xl-3 unloaded"></i> <span>HIRE ME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/FunkyMuse" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/funky_muse" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['funkymuse','protonmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>How long will you go to protect your Android app from being tampered?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How long will you go to protect your Android app from being tampered?</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> FunkyMuse </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jul 11, 2021, 4:30 PM +0200" prep="on" > Jul 11 <i class="unloaded">2021-07-11T16:30:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4018 words">22 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/10/1.jpg" class="center" /></p><h2 id="the-big-problem">The big problem</h2><hr /><p>Security of your app matters, whether you’re an indie developer trying to place a product and make a living out of your application, a big bank, a giant dating app or just an enthusiast who likes building Android apps.</p><p>We’re stuck in an apocalyptic world of <code class="language-plaintext highlighter-rouge">.apk</code> files, that are easily decompiled and it doesn’t require a lot of knowledge to tamper with the existing code.</p><p>An <code class="language-plaintext highlighter-rouge">APK</code> file contains all of a program’s code (such as <code class="language-plaintext highlighter-rouge">.dex</code> a.k.a classes files), <code class="language-plaintext highlighter-rouge">libs</code>, <code class="language-plaintext highlighter-rouge">resources</code>, <code class="language-plaintext highlighter-rouge">assets</code>, <code class="language-plaintext highlighter-rouge">certificates</code>, and <code class="language-plaintext highlighter-rouge">manifest file</code>, also that <code class="language-plaintext highlighter-rouge">APK</code> file is vulnerable.</p><p>If you noticed how cringey the meme is, that’s how cringey it is to reverse-engineer an Android <code class="language-plaintext highlighter-rouge">.apk</code>, it’s cringely funny and easy.</p><p><a href="https://github.com/pxb1988/dex2jar">dex2jar</a> converts <code class="language-plaintext highlighter-rouge">.apk</code> to <code class="language-plaintext highlighter-rouge">.jar</code>, using <a href="https://java-decompiler.github.io/">jd-gui</a> you can even look at the <code class="language-plaintext highlighter-rouge">Java/Kotlin</code> code (most of the time at least) and if you want to extract the resources (you probably need images, translations etc…) <a href="https://ibotpeaches.github.io/Apktool/">apktool</a> is here to help you.</p><p>You don’t even need to use the aforementioned tools, there are other websites that had this implemented and will do the heavy burden of writing scripts or doing the job yourself, just drop them an <code class="language-plaintext highlighter-rouge">.apk</code> and within minutes they’re done.</p><h2 id="finding-or-just-salvaging-a-solution-is-there-a-silver-bullet">Finding or just salvaging a solution, is there a silver bullet?</h2><hr /><p>You might think, of course there’s something that has to be done in order to protect our applications, matter of fact there is, you can only mitigate the solution until someone outsmarts it.</p><p><strong>Is there a silver bullet?</strong></p><p><em>NO!</em></p><h3 id="r8proguard">R8/Proguard</h3><hr /><p>You might have heard of proguard, it will obfuscate the code by giving random meaningless names to all methods, classes and variables, you might see something like <code class="language-plaintext highlighter-rouge">axv</code> <code class="language-plaintext highlighter-rouge">bdsa</code> classes or mix up of chars up to several other letters that you can barely even understand, this also does optimize the code.</p><h3 id="dexguard">Dexguard</h3><hr /><p>ProGuard is a generic optimizer for Java bytecode.</p><p>DexGuard is a specialized tool for the protection of Android applications.</p><p>At least that’s what they claim, that is a paid option and comes at a hefty price, all in all these two solutions do not entirely protect your app from being tampered.</p><p>Keep in mind that these tools alone do not solve your problem, they just slow down a determined individual.</p><h3 id="kotlin-messing-up-things">Kotlin messing up things</h3><hr /><p>We all love Kotlin alright, it enabled us to make apps that Java never did, especially writing non-confusing lambdas, null pointer safety and all other handy features.</p><p>But that comes with a price.</p><p>One day you’re enabling <code class="language-plaintext highlighter-rouge">R8</code> and <code class="language-plaintext highlighter-rouge">proguard</code>, minifying and obfuscating code and your class is dead simple</p><ul><li>The <code class="language-plaintext highlighter-rouge">Intrinsics</code> way and the <strong>meta-data</strong> way</ul><p>You’ve been exposed by the Kotlin compiler.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DeadSimpleClass</span> <span class="p">{</span>

    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">leastImportantVariable</span><span class="p">:</span> <span class="nc">String</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">lazyVariable</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span> 
        <span class="s">"someString"</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">someFunction</span><span class="p">(</span><span class="n">someAbnormalString</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">aList</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;)</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">doSomething</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>when we decompile this class to <code class="language-plaintext highlighter-rouge">Java</code> bytecode we get</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kotlin.Lazy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kotlin.LazyKt</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kotlin.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kotlin.jvm.functions.Function0</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kotlin.jvm.internal.Intrinsics</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jetbrains.annotations.NotNull</span><span class="o">;</span>

<span class="nd">@Metadata</span><span class="o">(</span>
   <span class="n">mv</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">},</span>
   <span class="n">bv</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">},</span>
   <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span>
   <span class="n">d1</span> <span class="o">=</span> <span class="o">{</span><span class="s">"\u0000$\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0002\b\u0002\n\u0002\u0010\u000e\n\u0002\b\t\n\u0002\u0010\u0002\n\u0002\b\u0002\n\u0002\u0010 \n\u0002\b\u0002\u0018\u00002\u00020\u0001B\u0005¢\u0006\u0002\u0010\u0002J\u001c\u0010\r\u001a\u00020\u000e2\u0006\u0010\u000f\u001a\u00020\u00042\f\u0010\u0010\u001a\b\u0012\u0004\u0012\u00020\u00040\u0011J\n\u0010\u0012\u001a\u00020\u000e*\u00020\u0004R\u001b\u0010\u0003\u001a\u00020\u00048BX\u0082\u0084\u0002¢\u0006\f\n\u0004\b\u0007\u0010\b\u001a\u0004\b\u0005\u0010\u0006R\u001a\u0010\t\u001a\u00020\u0004X\u0086.¢\u0006\u000e\n\u0000\u001a\u0004\b\n\u0010\u0006\"\u0004\b\u000b\u0010\f¨\u0006\u0013"</span><span class="o">},</span>
   <span class="n">d2</span> <span class="o">=</span> <span class="o">{</span><span class="s">"LDeadSimpleClass;"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"()V"</span><span class="o">,</span> <span class="s">"lazyVariable"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"getLazyVariable"</span><span class="o">,</span> <span class="s">"()Ljava/lang/String;"</span><span class="o">,</span> <span class="s">"lazyVariable$delegate"</span><span class="o">,</span> <span class="s">"Lkotlin/Lazy;"</span><span class="o">,</span> <span class="s">"leastImportantVariable"</span><span class="o">,</span> <span class="s">"getLeastImportantVariable"</span><span class="o">,</span> <span class="s">"setLeastImportantVariable"</span><span class="o">,</span> <span class="s">"(Ljava/lang/String;)V"</span><span class="o">,</span> <span class="s">"someFunction"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"someAbnormalString"</span><span class="o">,</span> <span class="s">"aList"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"doSomething"</span><span class="o">,</span> <span class="s">"untitled"</span><span class="o">}</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DeadSimpleClass</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="n">leastImportantVariable</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Lazy</span> <span class="n">lazyVariable$delegate</span><span class="o">;</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">getLeastImportantVariable</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">var10000</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">leastImportantVariable</span><span class="o">;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">var10000</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
         <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">throwUninitializedPropertyAccessException</span><span class="o">(</span><span class="s">"leastImportantVariable"</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="k">return</span> <span class="n">var10000</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">setLeastImportantVariable</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">var1</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">var1</span><span class="o">,</span> <span class="s">"&lt;set-?&gt;"</span><span class="o">);</span>
      <span class="k">this</span><span class="o">.</span><span class="na">leastImportantVariable</span> <span class="o">=</span> <span class="n">var1</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">getLazyVariable</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">Lazy</span> <span class="n">var1</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">lazyVariable</span><span class="n">$delegate</span><span class="o">;</span>
      <span class="nc">Object</span> <span class="n">var3</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
      <span class="kt">boolean</span> <span class="n">var4</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">return</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">var1</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">someFunction</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">someAbnormalString</span><span class="o">,</span> <span class="nd">@NotNull</span> <span class="nc">List</span> <span class="n">aList</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">someAbnormalString</span><span class="o">,</span> <span class="s">"someAbnormalString"</span><span class="o">);</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">aList</span><span class="o">,</span> <span class="s">"aList"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">$this$doSomething</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">$this$doSomething</span><span class="o">,</span> <span class="s">"$this$doSomething"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nf">DeadSimpleClass</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">lazyVariable</span><span class="n">$delegate</span> <span class="o">=</span> <span class="nc">LazyKt</span><span class="o">.</span><span class="na">lazy</span><span class="o">((</span><span class="nc">Function0</span><span class="o">)</span><span class="kc">null</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>You’ve noticed something by now?</p><p>Variables and method names are still here!</p><p>These names could expose your business logic to an outsider and this information may be used in a harfmul way for your app.</p><p>We can <strong>NOT</strong> fix the <code class="language-plaintext highlighter-rouge">Instrinsics</code> way by adding a proguard rules.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>-assumenosideeffects class kotlin.jvm.internal.Intrinsics { *; }
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">-assumenosideeffects</code>: ProGuard removes calls to such methods, if it can determine that the return values aren’t used. <strong>Only applicable when optimizing.</strong></p><p><em>DO NOT ADD THIS TO THE RULES!</em></p><p>Remove all Intrinsics calls will lead to errors, imagine we remove <code class="language-plaintext highlighter-rouge">equals</code> call for data classes and wonder why our diff utils aren’t working for example.</p><ul><li><code class="language-plaintext highlighter-rouge">Data class</code> way</ul><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">data class</span> <span class="nc">DeadSimpleClass</span><span class="p">(</span><span class="kd">val</span> <span class="py">funky</span><span class="p">:</span><span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">muse</span><span class="p">:</span><span class="nc">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">someOtherString</span><span class="p">:</span><span class="nc">String</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">kotlin.Metadata</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">kotlin.jvm.internal.Intrinsics</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jetbrains.annotations.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jetbrains.annotations.Nullable</span><span class="o">;</span>

<span class="nd">@Metadata</span><span class="o">(</span>
   <span class="n">mv</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">3</span><span class="o">},</span>
   <span class="n">bv</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">},</span>
   <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span>
   <span class="n">d1</span> <span class="o">=</span> <span class="o">{</span><span class="s">"\u0000\"\n\u0002\u0018\u0002\n\u0002\u0010\u0000\n\u0000\n\u0002\u0010\u000e\n\u0002\b\f\n\u0002\u0010\u000b\n\u0002\b\u0002\n\u0002\u0010\b\n\u0002\b\u0002\b\u0086\b\u0018\u00002\u00020\u0001B\u001d\u0012\u0006\u0010\u0002\u001a\u00020\u0003\u0012\u0006\u0010\u0004\u001a\u00020\u0003\u0012\u0006\u0010\u0005\u001a\u00020\u0003¢\u0006\u0002\u0010\u0006J\t\u0010\u000b\u001a\u00020\u0003HÆ\u0003J\t\u0010\f\u001a\u00020\u0003HÆ\u0003J\t\u0010\r\u001a\u00020\u0003HÆ\u0003J'\u0010\u000e\u001a\u00020\u00002\b\b\u0002\u0010\u0002\u001a\u00020\u00032\b\b\u0002\u0010\u0004\u001a\u00020\u00032\b\b\u0002\u0010\u0005\u001a\u00020\u0003HÆ\u0001J\u0013\u0010\u000f\u001a\u00020\u00102\b\u0010\u0011\u001a\u0004\u0018\u00010\u0001HÖ\u0003J\t\u0010\u0012\u001a\u00020\u0013HÖ\u0001J\t\u0010\u0014\u001a\u00020\u0003HÖ\u0001R\u0011\u0010\u0002\u001a\u00020\u0003¢\u0006\b\n\u0000\u001a\u0004\b\u0007\u0010\bR\u0011\u0010\u0004\u001a\u00020\u0003¢\u0006\b\n\u0000\u001a\u0004\b\t\u0010\bR\u0011\u0010\u0005\u001a\u00020\u0003¢\u0006\b\n\u0000\u001a\u0004\b\n\u0010\b¨\u0006\u0015"</span><span class="o">},</span>
   <span class="n">d2</span> <span class="o">=</span> <span class="o">{</span><span class="s">"LDeadSimpleClass;"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"funky"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"muse"</span><span class="o">,</span> <span class="s">"someOtherString"</span><span class="o">,</span> <span class="s">"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V"</span><span class="o">,</span> <span class="s">"getFunky"</span><span class="o">,</span> <span class="s">"()Ljava/lang/String;"</span><span class="o">,</span> <span class="s">"getMuse"</span><span class="o">,</span> <span class="s">"getSomeOtherString"</span><span class="o">,</span> <span class="s">"component1"</span><span class="o">,</span> <span class="s">"component2"</span><span class="o">,</span> <span class="s">"component3"</span><span class="o">,</span> <span class="s">"copy"</span><span class="o">,</span> <span class="s">"equals"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"other"</span><span class="o">,</span> <span class="s">"hashCode"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"toString"</span><span class="o">,</span> <span class="s">"untitled"</span><span class="o">}</span>
<span class="o">)</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">DeadSimpleClass</span> <span class="o">{</span>
   <span class="nd">@NotNull</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">funky</span><span class="o">;</span>
   <span class="nd">@NotNull</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">muse</span><span class="o">;</span>
   <span class="nd">@NotNull</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">someOtherString</span><span class="o">;</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">getFunky</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">funky</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">getMuse</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">muse</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">getSomeOtherString</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">someOtherString</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nf">DeadSimpleClass</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">funky</span><span class="o">,</span> <span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">muse</span><span class="o">,</span> <span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">someOtherString</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">funky</span><span class="o">,</span> <span class="s">"funky"</span><span class="o">);</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">muse</span><span class="o">,</span> <span class="s">"muse"</span><span class="o">);</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">someOtherString</span><span class="o">,</span> <span class="s">"someOtherString"</span><span class="o">);</span>
      <span class="kd">super</span><span class="o">();</span>
      <span class="k">this</span><span class="o">.</span><span class="na">funky</span> <span class="o">=</span> <span class="n">funky</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">muse</span> <span class="o">=</span> <span class="n">muse</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">someOtherString</span> <span class="o">=</span> <span class="n">someOtherString</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">component1</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">funky</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">component2</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">muse</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">String</span> <span class="nf">component3</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">someOtherString</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="kd">final</span> <span class="nc">DeadSimpleClass</span> <span class="nf">copy</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">funky</span><span class="o">,</span> <span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">muse</span><span class="o">,</span> <span class="nd">@NotNull</span> <span class="nc">String</span> <span class="n">someOtherString</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">funky</span><span class="o">,</span> <span class="s">"funky"</span><span class="o">);</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">muse</span><span class="o">,</span> <span class="s">"muse"</span><span class="o">);</span>
      <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">checkNotNullParameter</span><span class="o">(</span><span class="n">someOtherString</span><span class="o">,</span> <span class="s">"someOtherString"</span><span class="o">);</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">DeadSimpleClass</span><span class="o">(</span><span class="n">funky</span><span class="o">,</span> <span class="n">muse</span><span class="o">,</span> <span class="n">someOtherString</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="c1">// $FF: synthetic method</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="nc">DeadSimpleClass</span> <span class="n">copy$default</span><span class="o">(</span><span class="nc">DeadSimpleClass</span> <span class="n">var0</span><span class="o">,</span> <span class="nc">String</span> <span class="n">var1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">var2</span><span class="o">,</span> <span class="nc">String</span> <span class="n">var3</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var4</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">var5</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">((</span><span class="n">var4</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">var1</span> <span class="o">=</span> <span class="n">var0</span><span class="o">.</span><span class="na">funky</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="k">if</span> <span class="o">((</span><span class="n">var4</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">var2</span> <span class="o">=</span> <span class="n">var0</span><span class="o">.</span><span class="na">muse</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="k">if</span> <span class="o">((</span><span class="n">var4</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">var3</span> <span class="o">=</span> <span class="n">var0</span><span class="o">.</span><span class="na">someOtherString</span><span class="o">;</span>
      <span class="o">}</span>

      <span class="k">return</span> <span class="n">var0</span><span class="o">.</span><span class="na">copy</span><span class="o">(</span><span class="n">var1</span><span class="o">,</span> <span class="n">var2</span><span class="o">,</span> <span class="n">var3</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="nd">@NotNull</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="s">"DeadSimpleClass(funky="</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">funky</span> <span class="o">+</span> <span class="s">", muse="</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">muse</span> <span class="o">+</span> <span class="s">", someOtherString="</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">someOtherString</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">var10000</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">funky</span><span class="o">;</span>
      <span class="kt">int</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">var10000</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">var10000</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">)</span> <span class="o">*</span> <span class="mi">31</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">var10001</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">muse</span><span class="o">;</span>
      <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">var1</span> <span class="o">+</span> <span class="o">(</span><span class="n">var10001</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">var10001</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">))</span> <span class="o">*</span> <span class="mi">31</span><span class="o">;</span>
      <span class="n">var10001</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">someOtherString</span><span class="o">;</span>
      <span class="k">return</span> <span class="n">var1</span> <span class="o">+</span> <span class="o">(</span><span class="n">var10001</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">var10001</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">:</span> <span class="mi">0</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nd">@Nullable</span> <span class="nc">Object</span> <span class="n">var1</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">!=</span> <span class="n">var1</span><span class="o">)</span> <span class="o">{</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">var1</span> <span class="k">instanceof</span> <span class="nc">DeadSimpleClass</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">DeadSimpleClass</span> <span class="n">var2</span> <span class="o">=</span> <span class="o">(</span><span class="nc">DeadSimpleClass</span><span class="o">)</span><span class="n">var1</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Intrinsics</span><span class="o">.</span><span class="na">areEqual</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">funky</span><span class="o">,</span> <span class="n">var2</span><span class="o">.</span><span class="na">funky</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">areEqual</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">muse</span><span class="o">,</span> <span class="n">var2</span><span class="o">.</span><span class="na">muse</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="nc">Intrinsics</span><span class="o">.</span><span class="na">areEqual</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">someOtherString</span><span class="o">,</span> <span class="n">var2</span><span class="o">.</span><span class="na">someOtherString</span><span class="o">))</span> <span class="o">{</span>
               <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
         <span class="o">}</span>

         <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
         <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
      <span class="o">}</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>As you see, we still have the metadata and now we have the <code class="language-plaintext highlighter-rouge">public String toString()</code> exposing us as well with the variable names and also the copy method.</p><p>We can’t beat <code class="language-plaintext highlighter-rouge">String</code>s.</p><p><strong>DO NOT PUT</strong> sensitive info in shared preferences, they’re just basically <code class="language-plaintext highlighter-rouge">XML</code> that can be easily read, use <a href="https://developer.android.com/topic/security/data#edit-shared-preferences">Encrypted shared preferences</a>.</p><p>Also do not use unencrypted SQL database like Room, use a <a href="https://github.com/sqlcipher/android-database-sqlcipher">cipher</a> to make your database tables unreadable or some other way of encryption.</p><h3 id="we-cant-beat-strings">We can’t beat <code class="language-plaintext highlighter-rouge">String</code>s</h3><hr /><p>Every app connects to a service for some way of data source, it has to use an url/ip to fetch it from the source.</p><p>What seems to be the problem here? We’re exposing the <code class="language-plaintext highlighter-rouge">URL</code> to everyone out there, since everyone can decompile the app, everyone can catch the url and has a clear idea where the source is coming from.</p><p>There are ways to make this pain go away by security through obscurity but you can’t really fix this issue, some of the noble things you may have tried is</p><ol><li>Adding the url to <code class="language-plaintext highlighter-rouge">build.gradle</code> thinking it’s hidden, nope it’s not, the calling site where you provide the <code class="language-plaintext highlighter-rouge">url</code> to the function for ex. <code class="language-plaintext highlighter-rouge">Retrofit.Builder().setBaseUrl(BuildConfing.BASE_URL)</code> is gonna reveal your beloved and hidden <code class="language-plaintext highlighter-rouge">String</code>.<li>Scattering the URL as bytes and assembling it in one or from more places, again security through obscurity.<li>Reading the “secure” and hidden string from <code class="language-plaintext highlighter-rouge">.so</code> <em>C/C++</em> library and also in combination with #2, <code class="language-plaintext highlighter-rouge">IDA pro</code> or <code class="language-plaintext highlighter-rouge">Ghidra</code> can just print all the strings from the <code class="language-plaintext highlighter-rouge">.so</code>, so you’re not really secure.</ol><p>The best way to beat this is to use <code class="language-plaintext highlighter-rouge">https</code> for your communication with some token <code class="language-plaintext highlighter-rouge">auth</code> for your endpoints.</p><p>Another helpful things are <code class="language-plaintext highlighter-rouge">Certificate</code> Pinning, <code class="language-plaintext highlighter-rouge">Public Key</code> Pinning &amp; <code class="language-plaintext highlighter-rouge">Hash</code> Pinning.</p><ul><li><code class="language-plaintext highlighter-rouge">Certificate</code> Pinning - We store the certificate in our application and when the certificate expires, we would update our application with the new certificate. At runtime, we retrieve the server’s certificate in the callback, inside the callback, we compare the newly received certificate with the certificate shipped within our app, if it matches, we can trust the host else we will throw a SSL certificate error.</ul><p><strong>The downside to pinning a certificate</strong> Each time our server rotates a certificate, we need to update our application, imagine this happening frequently.</p><ul><li><code class="language-plaintext highlighter-rouge">Public Key</code> Pinning - We generate a keypair, we put the private key in our server and the public key inside our app. We check the extracted public key with its copy of the public key, if it matches like in the certificate pinning, we can trust the host else we will throw a SSL certificate error. By using public key pinning, we can avoid frequent application updates as the public key can remain same for longer periods.</ul><p><strong>The downside to Public Key pinning</strong></p><ol><li>Extracting the key is a process on it’s own<li>The key is <em>static</em> and may not align or even violate with the key rotation policies.</ol><ul><li><code class="language-plaintext highlighter-rouge">Hash Pinning</code> - we pin the hash of the <code class="language-plaintext highlighter-rouge">Public Key</code> of our server’s certificate and match it with the hash of the certificate’s public key received during a <em>network request</em>. When we receive a certificate can hash it with a secure hashing algorithm (<code class="language-plaintext highlighter-rouge">SHA-256</code> &gt; <code class="language-plaintext highlighter-rouge">Base64</code> for better readability) to provide anonymity to a certificate or public key.</ul><p>The problem still exists, the strings need to be provided at the calling site for your network service provider, that makes them visible, doesn’t matter if you use <code class="language-plaintext highlighter-rouge">Base64</code> or shifting bytes, a determined person can uncover them, just how far they’re willing to go?</p><p>But there are other problems that exist besides this one, these affect your app as well, every layer of security matters.</p><h3 id="app-modifiers">App modifiers</h3><hr /><p>As you might or might not be aware, <code class="language-plaintext highlighter-rouge">rooting</code> is a process of getting super-user privileges on <code class="language-plaintext highlighter-rouge">Android</code> since it runs on a <code class="language-plaintext highlighter-rouge">Linux</code> kernel, with that in mind you can use apps like <code class="language-plaintext highlighter-rouge">Magisk</code>, <code class="language-plaintext highlighter-rouge">Xposed</code> or the infamous <code class="language-plaintext highlighter-rouge">Lucky patcher</code> to modify or hook into other apps, but with root you can even modify system settings and even tamper the kernel.</p><p><code class="language-plaintext highlighter-rouge">Android</code> allows you to see which apps are installed on your device, if you detect that <code class="language-plaintext highlighter-rouge">Magisk</code> is installed you can just crash the app, you can try to run a <code class="language-plaintext highlighter-rouge">sudo</code> command as well and if it happens then you can crash the app to disallow <code class="language-plaintext highlighter-rouge">rooted</code> phones to use your app.</p><p>The problem arises when <code class="language-plaintext highlighter-rouge">Magisk</code> hides itself, <strong>YES</strong>, it can hide it’s name, although that’s also detectable.</p><p>Android 11 “came with a way to improve security” and disables a way for you to read every installed application on your phone, unless you</p><p><strong>Query specific packages - you must mention in the manifest which ones you’ll query</strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;manifest</span> <span class="na">package=</span><span class="s">"com.funkymuse.app"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;queries&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">android:name=</span><span class="s">"com.funkymuse.vigilante"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;package</span> <span class="na">android:name=</span><span class="s">"com.funkymuse.aurora"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/queries&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></table></code></div></div><p><strong>Use a permission</strong></p><p><code class="language-plaintext highlighter-rouge">&lt;uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/&gt;</code></p><p><strong>Query using intent filter</strong></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nt">&lt;manifest</span> <span class="na">package=</span><span class="s">"com.funkymuse.app"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;queries&gt;</span>
        <span class="nt">&lt;intent&gt;</span>
            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.SEND"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;data</span> <span class="na">android:mimeType=</span><span class="s">"image/png"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/intent&gt;</span>
    <span class="nt">&lt;/queries&gt;</span>
    ...
<span class="nt">&lt;/manifest&gt;</span>
</pre></table></code></div></div><p>and as you know each app must have a main intent action, we can safely abuse <strong>Query using intent filter</strong> and use</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="nt">&lt;queries&gt;</span>
        <span class="nt">&lt;intent&gt;</span>
            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/intent&gt;</span>
    <span class="nt">&lt;/queries&gt;</span>
</pre></table></code></div></div><p>to get every app that’s installed on the phone without even declaring a permission.</p><h2 id="security-checks-that-can-matter-to-you">Security checks that can matter to you</h2><hr /><p>Some of these may help you, some of these may be outdated in the future.</p><h3 id="inspecting-throwable-errors">Inspecting <code class="language-plaintext highlighter-rouge">Throwable</code> errors</h3><hr /><p>The best way to inspect if there’s something modified is by throwing an error and catching the trace then simply combing through the trace to check for bad guy’s hook.</p><p>This way you can see if there’s <code class="language-plaintext highlighter-rouge">xposed</code> or something <em>X</em> mentioned inside the <code class="language-plaintext highlighter-rouge">Throwable</code>’s stacktrace.</p><h3 id="detect-third-party-developers-kernel">Detect third-party developer’s kernel</h3><hr /><p>From a security standpoint <code class="language-plaintext highlighter-rouge">Release-Keys</code> generally means the kernel is more secure, which is not always the case.</p><p><code class="language-plaintext highlighter-rouge">Test-Keys</code> means it was signed with a custom key generated by a third-party developer.</p><p>Usually custom roms have <code class="language-plaintext highlighter-rouge">test-keys</code> if you want to strictly speaking disallow custom roms then you can detect it by</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">isTestKeyBuild</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">keys</span> <span class="p">=</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">TAGS</span>
    <span class="k">return</span> <span class="n">keys</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">keys</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"test-keys"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="detect-a-debugger">Detect a debugger</h3><hr /><p>A debugger can be easily attached to inspect behavior of an app</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">detectDebugger</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="nc">Debug</span><span class="p">.</span><span class="nf">isDebuggerConnected</span><span class="p">()</span>

<span class="k">fun</span> <span class="nc">Context</span><span class="p">.</span><span class="nf">isDebuggable</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="n">applicationContext</span><span class="p">.</span><span class="n">applicationInfo</span><span class="p">.</span><span class="n">flags</span> <span class="n">and</span> <span class="nc">ApplicationInfo</span><span class="p">.</span><span class="nc">FLAG_DEBUGGABLE</span> <span class="p">!=</span> <span class="mi">0</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Debug.threadCpuTimeNanos</code> indicates the amount of time that the current thread has been executing code</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">isDebuggerAttached</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">start</span> <span class="p">=</span> <span class="nc">Debug</span><span class="p">.</span><span class="nf">threadCpuTimeNanos</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="mi">999999</span><span class="p">)</span> <span class="k">continue</span>
    <span class="kd">val</span> <span class="py">stop</span> <span class="p">=</span> <span class="nc">Debug</span><span class="p">.</span><span class="nf">threadCpuTimeNanos</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">stop</span> <span class="p">-</span> <span class="n">start</span> <span class="p">&gt;=</span> <span class="mi">10000000</span>
<span class="p">}</span>
</pre></table></code></div></div><p>You can also check the <code class="language-plaintext highlighter-rouge">Settings.Global.WAIT_FOR_DEBUGGER</code> if it returns 1 then it will wait for debugger because it’s been enabled in the dev-options inside the Settings.</p><h3 id="crc-check">CRC check</h3><hr /><p>You can use a file that you ship in the strings or something else that’s inside the app, then do a <code class="language-plaintext highlighter-rouge">CRC</code> check to see if it’s modified.</p><p>For example you can calculate <code class="language-plaintext highlighter-rouge">CRC</code> on <code class="language-plaintext highlighter-rouge">.dex</code> files based on some layout resource, string etc… or coming from a file that you receive from a server and store offline like a time bomb.</p><h3 id="time-check">Time check</h3><hr /><p>This one can be done different ways, sometimes some app modifiers can set custom time to go back in time and do time based manipulations on a broken time verification based auth.</p><p>I would suggest using the <code class="language-plaintext highlighter-rouge">Calendar</code> class and having your application checking the current date against your expiration date in your <code class="language-plaintext highlighter-rouge">onResume</code> places.</p><h3 id="zygote-tampering">Zygote tampering</h3><hr /><p>Zygote is called only once when your app is forked on launch, which means that if it’s called more than once your app is modified.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="cm">/**
 * If the count is more than 2 then the app is modified
 * @return Int
 */</span>
<span class="k">fun</span> <span class="nf">zygoteCallCount</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="py">zygoteInitCallCount</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">Exception</span><span class="p">(</span><span class="s">"PiracyChecker"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">stackTraceElement</span> <span class="k">in</span> <span class="n">e</span><span class="p">.</span><span class="n">stackTrace</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stackTraceElement</span><span class="p">.</span><span class="n">className</span> <span class="p">==</span> <span class="s">"com.android.internal.os.ZygoteInit"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">zygoteInitCallCount</span><span class="p">++</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stackTraceElement</span><span class="p">.</span><span class="n">className</span> <span class="p">==</span> <span class="s">"com.saurik.substrate.MS$2"</span> <span class="p">&amp;&amp;</span> <span class="n">stackTraceElement</span><span class="p">.</span><span class="n">methodName</span> <span class="p">==</span> <span class="s">"invoked"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">zygoteInitCallCount</span><span class="p">++</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stackTraceElement</span><span class="p">.</span><span class="n">className</span> <span class="p">==</span> <span class="s">"de.robv.android.xposed.XposedBridge"</span> <span class="p">&amp;&amp;</span> <span class="n">stackTraceElement</span><span class="p">.</span><span class="n">methodName</span> <span class="p">==</span> <span class="s">"main"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">zygoteInitCallCount</span><span class="p">++</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stackTraceElement</span><span class="p">.</span><span class="n">className</span> <span class="p">==</span> <span class="s">"de.robv.android.xposed.XposedBridge"</span> <span class="p">&amp;&amp;</span> <span class="n">stackTraceElement</span><span class="p">.</span><span class="n">methodName</span> <span class="p">==</span> <span class="s">"handleHookedMethod"</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">zygoteInitCallCount</span><span class="p">++</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">zygoteInitCallCount</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="is-your-app-being-run-on-an-emulator">Is your app being run on an emulator</h3><hr /><p>Emulators are flexible, they can be rooted and played with in many ways, enabling dumping data, behavior and what not for your app, you can disable your app to work on emulators, this is a good idea especially for banking apps.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">isEmulator</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">BRAND</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"generic"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">DEVICE</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"generic"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">FINGERPRINT</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"generic"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">FINGERPRINT</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"unknown"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">HARDWARE</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"goldfish"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">HARDWARE</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"ranchu"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">MODEL</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"google_sdk"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">MODEL</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"Emulator"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">MODEL</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"Android SDK built for x86"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">MANUFACTURER</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"Genymotion"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"sdk_google"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"google_sdk"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"sdk"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"sdk_x86"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"vbox86p"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"emulator"</span><span class="p">)</span>
            <span class="p">||</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">PRODUCT</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"simulator"</span><span class="p">))</span> <span class="p">||</span> <span class="nf">isAlsoEmulator</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><p><em><a href="https://github.com/FunkyMuse/KAHelpers/blob/master/security/src/main/java/com/crazylegend/security/PiracyCheckers.kt#L143">Method reference</a></em></p><h3 id="check-if-developer-option-is-enabled-andor-check-if-usb-debugging-is-enabled">Check if Developer option is enabled and/or check if USB debugging is enabled</h3><hr /><p>Sometimes some of the requirements need of you to check that as well, especially some <em>banking</em> clients i’ve worked for had us perform this check</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nc">Context</span><span class="p">.</span><span class="nf">isDevModeEnabled</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="nc">Settings</span><span class="p">.</span><span class="nc">Secure</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(</span><span class="n">contentResolver</span><span class="p">,</span> <span class="nc">Settings</span><span class="p">.</span><span class="nc">Global</span><span class="p">.</span><span class="nc">DEVELOPMENT_SETTINGS_ENABLED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">!=</span> <span class="mi">0</span>
</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nc">Context</span><span class="p">.</span><span class="nf">isADBEnabled</span><span class="p">()</span> <span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="nc">Settings</span><span class="p">.</span><span class="nc">Secure</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(</span><span class="n">contentResolver</span><span class="p">,</span> <span class="nc">Settings</span><span class="p">.</span><span class="nc">Secure</span><span class="p">.</span><span class="nc">ADB_ENABLED</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">==</span> <span class="mi">1</span>
</pre></table></code></div></div><p>Link to some of the <a href="https://github.com/FunkyMuse/KAHelpers/blob/master/security/src/main/java/com/crazylegend/security/PiracyCheckers.kt">security functions</a></p><h3 id="inspect-sha-xxxmd5-signature-verify-your-apps-signing-certificates-signatures">Inspect SHA-XXX/MD5 signature (Verify your app’s signing certificates (signatures))</h3><hr /><p>The app signatures will be broken if the .apk is altered in any way — unsigned apps cannot typically be installed.</p><p>You can check the signature of the app if you had the string of the signature inside your app as a <code class="language-plaintext highlighter-rouge">String</code>, but strings aren’t a good solution, a server side validation can be additionally added for inspecting the signing signature, this is a great idea to check it every time the app is launched.</p><h3 id="app-id-check">App ID check</h3><hr /><p>If the app ID doesn’t match the one you’ve set, crash the app, this is a smart idea to have it done also via server side and have that call tied somewhere where the crucial functionality is a must.</p><h3 id="network-security-configuration">Network security configuration</h3><hr /><p>This one is awesomely explained by <a href="https://developer.android.com/training/articles/security-config">Google</a>.</p><h3 id="unlocked-bootloaders-and-safetynet-attestations">Unlocked bootloaders and SafetyNet attestations</h3><hr /><p>Another great example explained by <a href="https://developer.android.com/training/safetynet/attestation">Google</a>.</p><h3 id="server-side-country-validation">Server side country validation</h3><hr /><p>If you run a server to validate things, you can check if your user changed the country on the device, do note that this has also be checked if the user is using <code class="language-plaintext highlighter-rouge">VPN</code> as an internet connection.</p><h3 id="server-side-device-id-validation">Server side device ID validation</h3><hr /><p>If you have the Device ID of the user’s device, you can always check if it’s the same one the user registered with and/or you’ve later on stored on the server, this is also nice since the ID is unique to a device, like IMEI.</p><p><em>Do note that this requires a permission</em></p><h3 id="verify-whos-the-installer-of-your-app">Verify who’s the installer of your app</h3><hr /><p>If you haven’t distributed your application via any other store than Play store, then you have to check who’s the one that installed your app, if that doesn’t match with the package id, crash it.</p><h3 id="verify-google-play-licensing-lvl">Verify Google Play Licensing (LVL)</h3><hr /><p>Google Play offers a licensing service that lets you enforce licensing policies for applications that you publish on Google Play. With Google Play Licensing, your application can query Google Play to obtain the licensing status for the current user.</p><p>Check out the <a href="https://developer.android.com/google/play/licensing/index.html">Google Developers page</a>.</p><h3 id="check-if-disk-is-encrypted">Check if disk is encrypted</h3><hr /><p>Devices running Android 7.0–9 support full-disk encryption. New devices running Android 10 and higher must use file-based encryption.</p><ul><li>For new devices running Android 10 and higher, file-based encryption is required.<li>Devices running Android 9 and higher can use adoptable storage and file-based encryption.<li>For devices running Android 7.0–8.1, file-based encryption can’t be used together with adoptable storage. If file-based encryption is enabled on these devices, new storage media (such as an SD card) must be used as traditional storage.</ul><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">isDiskEncrypted</span> <span class="p">=</span> <span class="nc">DeviceUtils</span><span class="p">.</span><span class="nf">getSystemProperty</span><span class="p">(</span><span class="s">"ro.crypto.state"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="s">"encrypted"</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</pre></table></code></div></div><p><em><a href="https://github.com/FunkyMuse/KAHelpers/blob/master/kotlinextensions/src/main/java/com/crazylegend/kotlinextensions/storage/StorageExtensions.kt#L461">Method Reference</a></em></p><h3 id="project-adiantum">Project Adiantum</h3><hr /><blockquote><p><a href="https://source.android.com/security/encryption/adiantum">Adiantum</a> is an encryption method designed for devices running Android 9 and higher whose CPUs lack AES instructions.</p></blockquote><p>For devices lacking these AES CPU instructions, you can check if Adiantum is enabled for devices</p><p>You can check if a CPU has AES instructions by running a <a href="https://github.com/FunkyMuse/KAHelpers/blob/master/root/src/main/java/com/crazylegend/root/ShellCommands.kt#L59">shell command</a> in your code</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">grep </span>aes /proc/cpuinfo
</pre></table></code></div></div><p>If there’s an output that means you have AES and you can ignore checking for <code class="language-plaintext highlighter-rouge">Adiantum</code>, otherwise you can run the following commands</p><p>For Android 11 and higher:</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">getSystemProperty</span><span class="p">(</span><span class="s">"ro.crypto.volume.options"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="s">"adiantum"</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="nf">getSystemProperty</span><span class="p">(</span><span class="s">"ro.crypto.volume.metadata"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="s">"adiantum"</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</pre></table></code></div></div><p>For Android 9 and 10:</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nf">getSystemProperty</span><span class="p">(</span><span class="s">"ro.crypto.volume.contents_mode"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="s">"adiantum"</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="nf">getSystemProperty</span><span class="p">(</span><span class="s">"ro.crypto.volume.filenames_mode"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="s">"adiantum"</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
<span class="p">&amp;&amp;</span> <span class="nf">getSystemProperty</span><span class="p">(</span><span class="s">"ro.crypto.fde_algorithm"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="s">"adiantum"</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="automatic-backups">Automatic backups</h3><hr /><p>Android allows for backing up data content up to 25MBs, you can opt out by disabling that feature inside your <code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code>, this is a discussion with your security analyst whether to allow this feature or not, I always disable it due to the fact that I don’t want to rely on 3rd party system to do this for me.</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nt">&lt;manifest</span> <span class="err">...</span> <span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;application</span> <span class="na">android:allowBackup=</span><span class="s">"false"</span> <span class="err">...</span> <span class="nt">&gt;</span>
        ...
    <span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span>
</pre></table></code></div></div><h3 id="min-api-23">Min API 23</h3><hr /><p>It’s 2021 already and this shouldn’t be a debate, but Android &lt; 23 API hasn’t a pretty good security and everything that’s backported is just done with workarounds, some may argue against, some may agree, but supporting anything below 23 is just a waste of resources.</p><h3 id="do-not-export-your-services-activities-unless-theres-an-use-case">Do not export your services, activities unless there’s an use-case</h3><hr /><p>Service that is unprotected by permissions and which sends sensitive information when started by an arbitrary application</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;activity</span> <span class="na">android:exported=</span><span class="s">"false"</span> <span class="err">...</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter</span> <span class="nt">&gt;</span> ... <span class="nt">&lt;/intent-filter&gt;</span>
    ...
<span class="nt">&lt;/activity&gt;</span>
</pre></table></code></div></div><p>same goes for <code class="language-plaintext highlighter-rouge">Service</code>.</p><p>Courtesy of <a href="https://wiki.sei.cmu.edu/confluence/display/android/DRD07-X.+Protect+exported+services+with+strong+permissions">CMU</a>.</p><h3 id="limit-a-webview">Limit a Webview</h3><hr /><p>Do not allow <code class="language-plaintext highlighter-rouge">WebView</code> to access sensitive local resource/s through file scheme, that is being enabled by the <code class="language-plaintext highlighter-rouge">JavaScript</code> through the settings of a <code class="language-plaintext highlighter-rouge">WebView</code>, all in all using <code class="language-plaintext highlighter-rouge">WebView</code> in a secure application is probably not a great idea or in the end, as you see fit?</p><h3 id="do-not-cache-sensitive-information">Do not cache sensitive information</h3><hr /><p>Information that is cached may become accessible to other applications, and certainly becomes accessible if the device is found or stolen by a third party.</p><h3 id="check-that-a-calling-app-has-appropriate-permissions-before-responding">Check that a calling app has appropriate permissions before responding</h3><hr /><p>If an app is using a granted permission to respond to a calling app then it must check that the calling app has that permission as well. Otherwise, the responding app may be granting privileges to the calling app that it should not have. (This is sometimes called the “confused deputy” problem.)</p><p>The methods <code class="language-plaintext highlighter-rouge">Context.checkCallingPermission()</code> and <code class="language-plaintext highlighter-rouge">Context.enforceCallingPermission()</code> can be used to ensure that the calling app has the correct permissions.</p><p><a href="https://wiki.sei.cmu.edu/confluence/display/android/DRD14-J.+Check+that+a+calling+app+has+appropriate+permissions+before+responding">Reference</a></p><h3 id="always-canonicalize-a-url-received-by-a-content-provider">Always canonicalize a URL received by a content provider</h3><hr /><p>By using the <code class="language-plaintext highlighter-rouge">ContentProvider.openFile()</code> method, you can provide a facility for another application to access your application data (file). Depending on the implementation of ContentProvider, use of the method can lead to a directory traversal vulnerability.</p><p>Therefore, when exchanging a file through a content provider, the path should be canonicalized before it is used.</p><p><a href="https://wiki.sei.cmu.edu/confluence/display/android/DRD08-J.+Always+canonicalize+a+URL+received+by+a+content+provider">Reference</a></p><h3 id="discourage-face-id">Discourage Face ID</h3><hr /><p>If someone looks similar as the person who did the verification, then you already know the answer here, make sure that when you check biometrics settings, you discourage logging in with a <em>Face ID</em>.</p><h3 id="test-your-apps-security">Test your app’s security</h3><hr /><p>A great tool to test your app’s security is <a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a></p><p>It does static and dynamic analysis.</p><h2 id="teach-your-user">Teach your user</h2><hr /><p><strong>Always</strong> assume that the user of the application is dumb.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/10/3.webp" class="center" /></p><p>You need to create a guide explaining how the user should take precaution and do that thoroughly, not everyone is a <em>power</em> user or knows the system pretty well.</p><p>It usually comes in form of good <em>UI/UX</em>.</p><h3 id="closing-notes">Closing notes</h3><hr /><p>Designing a secure <code class="language-plaintext highlighter-rouge">Android</code> application is hard, or maybe impossible, there’s always a risk, the more paranoid you are about security, the more it matters.</p><p>Working on banking apps and with clients that are really paranoid about this kind of thing, enabled me to share some of these practices, there will be more in the future but some are already known such as using strong encryption etc…</p><p>Is the price you pay for making a “secure” and “untamperable” application your time and effort?</p><p><em>So be it</em>.</p><p><strong>How long are you willing to go?</strong></p><p>or <em>does the budget allow this?</em></p><p>Thanks for reading and stay tuned for more articles.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a>, <a href='/categories/security/'>Security</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a> <a href="/tags/security/" class="post-tag no-text-decoration" >Security</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How long will you go to protect your Android app from being tampered? - FunkyMuse&url=https://funkymuse.github.io/posts/android_anti_tampering/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How long will you go to protect your Android app from being tampered? - FunkyMuse&u=https://funkymuse.github.io/posts/android_anti_tampering/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=How long will you go to protect your Android app from being tampered? - FunkyMuse&url=https://funkymuse.github.io/posts/android_anti_tampering/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://funkymuse.github.io/posts/android_anti_tampering/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://www.reddit.com/submit?url=https://funkymuse.github.io/posts/android_anti_tampering/&title=How long will you go to protect your Android app from being tampered? - FunkyMuse" data-toggle="tooltip" data-placement="top" title="Reddit" target="_blank" rel="noopener" aria-label="Reddit"> <i class="fa-fw fab fa-reddit"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/dagger-part-5/"><div class="card-body"> <span class="timeago small" > Mar 29 <i class="unloaded">2021-03-29T22:45:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 5</h3><div class="text-muted small"><p> In the previous post we’ve explored scope operators. In this post we’ll encounter subcomponents and their hierarchy, custom scopes and let’s not waste any time. Starting off by including the an...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-6/"><div class="card-body"> <span class="timeago small" > Apr 2 <i class="unloaded">2021-04-02T20:05:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 6</h3><div class="text-muted small"><p> In the previous post we’ve encountered subcomponents and their hierarchy, custom scopes and we did not waste any time. In this post we’ll learn when’s the right place to inject, named and qualif...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-7/"><div class="card-body"> <span class="timeago small" > Apr 6 <i class="unloaded">2021-04-06T23:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 7</h3><div class="text-muted small"><p> In the previous post we’ve encountered when’s the right place to inject, named and qualifiers. In this post we’ll learn about multi bindings and their power. They’re your best buddies in the Da...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/arch_components_donts/" class="btn btn-outline-primary" prompt="Older"><p>Common mistakes when using Architecture Components</p></a> <a href="/posts/software_engineering_2021/" class="btn btn-outline-primary" prompt="Newer"><p>Modern software engineering or just a gardener's job!?</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/funky_muse">FunkyMuse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://funkymuse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
