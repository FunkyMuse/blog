<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Dagger2 is hard, but it can be easy, part 6" /><meta name="author" content="FunkyMuse" /><meta property="og:locale" content="en_US" /><meta name="description" content="Blog containing Kotlin and Android goodies." /><meta property="og:description" content="Blog containing Kotlin and Android goodies." /><link rel="canonical" href="https://funkymuse.github.io/posts/dagger-part-6/" /><meta property="og:url" content="https://funkymuse.github.io/posts/dagger-part-6/" /><meta property="og:site_name" content="FunkyMuse" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-02T20:05:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Dagger2 is hard, but it can be easy, part 6" /><meta name="twitter:site" content="@funky_muse" /><meta name="twitter:creator" content="@FunkyMuse" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"FunkyMuse"},"description":"Blog containing Kotlin and Android goodies.","url":"https://funkymuse.github.io/posts/dagger-part-6/","@type":"BlogPosting","headline":"Dagger2 is hard, but it can be easy, part 6","dateModified":"2021-04-02T20:05:00+02:00","datePublished":"2021-04-02T20:05:00+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://funkymuse.github.io/posts/dagger-part-6/"},"@context":"https://schema.org"}</script><title>Dagger2 is hard, but it can be easy, part 6 | FunkyMuse</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">FunkyMuse</a></div><div class="site-subtitle font-italic">Anything which inspires everything</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/apps/" class="nav-link"> <i class="fa-fw fas fa-mobile ml-xl-3 mr-xl-3 unloaded"></i> <span>APPLICATIONS</span> </a><li class="nav-item"> <a href="/hire_me/" class="nav-link"> <i class="fa-fw fas fa-code ml-xl-3 mr-xl-3 unloaded"></i> <span>HIRE ME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/FunkyMuse" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/funky_muse" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['funkymuse','protonmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Dagger2 is hard, but it can be easy, part 6</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Dagger2 is hard, but it can be easy, part 6</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> FunkyMuse </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 2, 2021, 8:05 PM +0200" prep="on" > Apr 2 <i class="unloaded">2021-04-02T20:05:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2320 words">12 min</span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/dagger/dagger_title.jpeg" class="center" /></p><p>In the <a href="/posts/dagger-part-5/">previous</a> post we’ve encountered subcomponents and their hierarchy, custom scopes and we did not waste any time.</p><p>In this post we’ll learn when’s the right place to inject, named and qualifiers.</p><h2 id="applications-correct-place-for-injection">Application’s correct place for injection</h2><hr /><p>We’ve seen in the <a href="/posts/dagger-part-5/">previous</a> post when’s the right place to inject the <code class="language-plaintext highlighter-rouge">@Singleton</code> scope, as a reminder it should be right before the super.onCreate in your <code class="language-plaintext highlighter-rouge">: Application</code> inheritance</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">applicationComponent</span> <span class="p">=</span> <span class="nc">DaggerSingletonComponent</span><span class="p">.</span><span class="nf">factory</span><span class="p">().</span><span class="nf">create</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">provideGraphInside</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">()</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="fragments-correct-place-for-injection">Fragment’s correct place for injection</h2><hr /><p>Go ahead and create a Fragment subcomponent</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Subcomponent</span><span class="p">(</span><span class="n">modules</span> <span class="p">=</span> <span class="p">[</span><span class="nc">FragmentModule</span><span class="o">::</span><span class="k">class</span><span class="p">])</span>
<span class="nd">@FragmentScoped</span>
<span class="kd">interface</span> <span class="nc">FragmentComponent</span> <span class="p">{</span>

    <span class="nd">@Subcomponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">():</span> <span class="nc">FragmentComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">inject</span><span class="p">(</span><span class="n">homeFragment</span><span class="p">:</span> <span class="nc">HomeFragment</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>an empty Fragment module if you want to use later on (optional)</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@Module</span>
<span class="kd">object</span> <span class="nc">FragmentModule</span> <span class="p">{</span>


<span class="p">}</span>
</pre></table></code></div></div><p>a scope for our fragment</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Scope</span>
<span class="nd">@MustBeDocumented</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="nc">AnnotationRetention</span><span class="p">.</span><span class="nc">RUNTIME</span><span class="p">)</span>
<span class="k">annotation</span> <span class="kd">class</span> <span class="nc">FragmentScoped</span>
</pre></table></code></div></div><p>and add</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">fragmentComponentFactory</span><span class="p">():</span> <span class="nc">FragmentComponent</span><span class="p">.</span><span class="nc">Factory</span>
</pre></table></code></div></div><p>in our <code class="language-plaintext highlighter-rouge">SingletonComponent</code> right above/below your</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">activityComponentFactory</span><span class="p">():</span> <span class="nc">ActivityComponent</span><span class="p">.</span><span class="nc">Factory</span>
</pre></table></code></div></div><p>a <code class="language-plaintext highlighter-rouge">HomeFragment</code> class for demonstration</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">HomeFragment</span> <span class="p">:</span> <span class="nc">Fragment</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">home_fragment</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onAttach</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">injector</span> <span class="p">{</span>
            <span class="nf">fragmentComponentFactory</span><span class="p">().</span><span class="nf">create</span><span class="p">().</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="nd">@HomeFragment</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onAttach</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>as you can see, the correct place to inject a <em>Fragment</em> is in <code class="language-plaintext highlighter-rouge">onAttach</code> since that’s called just once when the Fragment is attached and as an analogy destroyed when the fragment is detached.</p><p>Our <code class="language-plaintext highlighter-rouge">injector</code> extension function changed a bit</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">inline</span> <span class="k">fun</span> <span class="nc">FragmentActivity</span><span class="p">.</span><span class="nf">injector</span><span class="p">(</span><span class="n">action</span><span class="p">:</span> <span class="nc">SingletonComponent</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="n">application</span> <span class="k">as</span> <span class="nc">DaggerIsEasyApplication</span><span class="p">).</span><span class="n">applicationComponent</span><span class="p">.</span><span class="nf">action</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">inline</span> <span class="k">fun</span> <span class="nc">Fragment</span><span class="p">.</span><span class="nf">injector</span><span class="p">(</span><span class="n">action</span><span class="p">:</span> <span class="nc">SingletonComponent</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">requireActivity</span><span class="p">().</span><span class="nf">injector</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>we changed from <code class="language-plaintext highlighter-rouge">AppcompatActivity.injector</code> to <code class="language-plaintext highlighter-rouge">FragmentActivity</code> so that we can reuse it for our <code class="language-plaintext highlighter-rouge">Fragment.injector</code> which has a <code class="language-plaintext highlighter-rouge">requireActivity()</code> that’s of a type <code class="language-plaintext highlighter-rouge">FragmentActivity</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/dagger/6/very_nice.jpg" class="center" /></p><h2 id="activitys-correct-place-for-injection">Activity’s correct place for injection</h2><hr /><p>When it comes to an Activity we can go one way or the other, in the previous post we’ve bound the instance of <code class="language-plaintext highlighter-rouge">savedInstanceState</code> and <code class="language-plaintext highlighter-rouge">intent</code> just to see the different approaches now.</p><ol><li>onCreate just before super.onCreate like in the <code class="language-plaintext highlighter-rouge">: Application</code> as seen in the <a href="/posts/dagger-part-5/">previous</a> post<div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
     <span class="nf">injector</span> <span class="p">{</span>
         <span class="nf">activityComponentFactory</span><span class="p">().</span><span class="nf">create</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">,</span> <span class="n">intent</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="nd">@MainActivity</span><span class="p">)</span> <span class="p">}</span>
     <span class="p">}</span>
     <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
 <span class="p">}</span>
</pre></table></code></div></div><li><code class="language-plaintext highlighter-rouge">addOnContextAvailableListener</code> when it comes to this method we can have something like<div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

 <span class="nf">init</span> <span class="p">{</span>
     <span class="nf">addOnContextAvailableListener</span> <span class="p">{</span>
         <span class="nf">injector</span> <span class="p">{</span>
             <span class="nf">activityComponentFactory</span><span class="p">().</span><span class="nf">create</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">,</span> <span class="n">intent</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="nd">@MainActivity</span><span class="p">)</span> <span class="p">}</span>
         <span class="p">}</span>
     <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>When’s <code class="language-plaintext highlighter-rouge">addOnContextAvailableListener</code> called?</p></ol><ul><li><p><code class="language-plaintext highlighter-rouge">A</code> &gt; If you do your injection inside <code class="language-plaintext highlighter-rouge">onCreate(savedInstanceState: Bundle?)</code> before <code class="language-plaintext highlighter-rouge">super.onCreate(savedInstanceState)</code> then this is called before <code class="language-plaintext highlighter-rouge">addOnContextAvailableListener</code> has a context available.</p><li><p><code class="language-plaintext highlighter-rouge">B</code> &gt; If you do your injection inside <code class="language-plaintext highlighter-rouge">addOnContextAvailableListener</code> then this is done also before <code class="language-plaintext highlighter-rouge">super.onCreate(savedInstanceState)</code> but right after <code class="language-plaintext highlighter-rouge">A</code></p></ul><p>Our example is tied to providing instances of <code class="language-plaintext highlighter-rouge">savedInstanceState, intent</code> which shows us that it depends on your use case and how you created the whole logic.</p><p>Make sure you’re having the latest appCompat dependency to get the context listener, as of writing this blogpost, i’m using</p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">implementation</span> <span class="s2">"androidx.appcompat:appcompat:1.3.0-rc01"</span>
</pre></table></code></div></div><p>To correct our sample if we’re to use the injection in the context available listener we have to do the following</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="nf">addOnContextAvailableListener</span> <span class="p">{</span> <span class="n">availableContext</span> <span class="p">-&gt;</span>
            <span class="nf">injector</span> <span class="p">{</span>
                <span class="nf">activityComponentFactory</span><span class="p">().</span><span class="nf">create</span><span class="p">(</span><span class="n">availableContext</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="nd">@MainActivity</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and correct our <code class="language-plaintext highlighter-rouge">ActivityComponent</code>’s create function to receive a <code class="language-plaintext highlighter-rouge">Context</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Subcomponent</span><span class="p">(</span><span class="n">modules</span> <span class="p">=</span> <span class="p">[</span><span class="nc">ActivityModule</span><span class="o">::</span><span class="k">class</span><span class="p">])</span>
<span class="nd">@ActivityScoped</span>
<span class="kd">interface</span> <span class="nc">ActivityComponent</span> <span class="p">{</span>

    <span class="nd">@Subcomponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">ActivityComponent</span>
    <span class="p">}</span>
    
    <span class="k">fun</span> <span class="nf">inject</span><span class="p">(</span><span class="n">mainActivity</span><span class="p">:</span> <span class="nc">MainActivity</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>then you press F10 and build the application, it crashes.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">error</span><span class="p">:</span> <span class="p">[</span><span class="nc">Dagger</span><span class="p">/</span><span class="nc">DuplicateBindings</span><span class="p">]</span> <span class="n">android</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="nc">Context</span> <span class="k">is</span> <span class="n">bound</span> <span class="n">multiple</span> <span class="n">times</span>
</pre></table></code></div></div><p>That means we already have a <code class="language-plaintext highlighter-rouge">Context</code> bound, when we built our <code class="language-plaintext highlighter-rouge">SingletonComponent</code>, one way to fix this is</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@Singleton</span>
<span class="kd">interface</span> <span class="nc">SingletonComponent</span> <span class="p">{</span>
    <span class="nd">@Component</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">SingletonComponentFactory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Application</span><span class="p">):</span> <span class="nc">SingletonComponent</span>
    <span class="p">}</span>
    <span class="k">fun</span> <span class="nf">activityComponentFactory</span><span class="p">()</span> <span class="p">:</span> <span class="nc">ActivityComponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="k">fun</span> <span class="nf">provideGraphInside</span><span class="p">(</span><span class="n">application</span><span class="p">:</span> <span class="nc">DaggerIsEasyApplication</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>but having <code class="language-plaintext highlighter-rouge">@BindsInstance context: Application</code> means that we have to change every place where we have our application context to be of a type <code class="language-plaintext highlighter-rouge">Application</code>.</p><p>The other one is to use a Qualifier or Named, these are more elegant solutions.</p><p>For this demonstration go ahead and delete <code class="language-plaintext highlighter-rouge">Bundler</code> and <code class="language-plaintext highlighter-rouge">IntentHandler</code> classes and remove them from everywhere we’ve used them so far, we won’t be needing them anymore.</p><h2 id="named">Named</h2><hr /><p>When we use named, we have to use <code class="language-plaintext highlighter-rouge">@Named</code> which is an annotation that takes a string as an argument and you have to write the string yourself which can be prone to errors if you don’t expose it as a constant, meaning that writing one string at two places can be prone to a human error (typo etc..).</p><p>To avoid our <code class="language-plaintext highlighter-rouge">Context</code> clash that we had, we have to use <code class="language-plaintext highlighter-rouge">@Named</code> to the instance in our case <code class="language-plaintext highlighter-rouge">@Named(APPLICATION_CONTEXT_NAME)</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@Singleton</span>
<span class="kd">interface</span> <span class="nc">SingletonComponent</span> <span class="p">{</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kd">val</span> <span class="py">APPLICATION_CONTEXT_NAME</span> <span class="p">=</span> <span class="s">"applicationContext"</span>
    <span class="p">}</span>

    <span class="nd">@Component</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">SingletonComponentFactory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="nd">@Named</span><span class="p">(</span><span class="nc">APPLICATION_CONTEXT_NAME</span><span class="p">)</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">SingletonComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">activityComponentFactory</span><span class="p">():</span> <span class="nc">ActivityComponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="k">fun</span> <span class="nf">fragmentComponentFactory</span><span class="p">():</span> <span class="nc">FragmentComponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="k">fun</span> <span class="nf">provideGraphInside</span><span class="p">(</span><span class="n">application</span><span class="p">:</span> <span class="nc">DaggerIsEasyApplication</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>and in our <code class="language-plaintext highlighter-rouge">ActivityComponent</code> we have <code class="language-plaintext highlighter-rouge">@Named(ACTIVITY_CONTEXT_NAME)</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="nd">@Subcomponent</span><span class="p">(</span><span class="n">modules</span> <span class="p">=</span> <span class="p">[</span><span class="nc">ActivityModule</span><span class="o">::</span><span class="k">class</span><span class="p">])</span>
<span class="nd">@ActivityScoped</span>
<span class="kd">interface</span> <span class="nc">ActivityComponent</span> <span class="p">{</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">const</span> <span class="kd">val</span> <span class="py">ACTIVITY_CONTEXT_NAME</span> <span class="p">=</span> <span class="s">"activityContext"</span>
    <span class="p">}</span>

    <span class="nd">@Subcomponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="nd">@Named</span><span class="p">(</span><span class="nc">ACTIVITY_CONTEXT_NAME</span><span class="p">)</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">ActivityComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">inject</span><span class="p">(</span><span class="n">mainActivity</span><span class="p">:</span> <span class="nc">MainActivity</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>now we’ve used an <code class="language-plaintext highlighter-rouge">Application</code>’s <code class="language-plaintext highlighter-rouge">Context</code> in <code class="language-plaintext highlighter-rouge">SharedPreferencesManager</code></p><p>the change that has to be done as well</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Singleton</span>
<span class="kd">class</span> <span class="nc">SharedPreferencesManager</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span><span class="nd">@Named</span><span class="p">(</span><span class="nc">SingletonComponent</span><span class="p">.</span><span class="nc">APPLICATION_CONTEXT_NAME</span><span class="p">)</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">@Named(SingletonComponent.APPLICATION_CONTEXT_NAME)</code> means that when Dagger comes into conflicts for the instances of the same type, it can provide them by a name we’ve <em>explicitly</em> instructed it to do.</p><h2 id="qualifier">Qualifier</h2><hr /><p>The qualifier approach is something <em>I personally</em> prefer to use, because it requires of you as a developer to create a separate <code class="language-plaintext highlighter-rouge">Qualifier</code> annotation and I can find it easily into the package where I use that module or class that’s using the qualifier or (your use case or preference here).</p><p>To create a <code class="language-plaintext highlighter-rouge">@Qualifier</code> is really easy, just create a new annotation and add the <code class="language-plaintext highlighter-rouge">@Qualifier</code> and <code class="language-plaintext highlighter-rouge">@Retention(AnnotationRetention.BINARY)</code></p><p>Why <code class="language-plaintext highlighter-rouge">BINARY</code> you might ask yourself, that’s because the annotation is stored in a binary form which is inaccessible for reflection.</p><p>Go ahead and create <code class="language-plaintext highlighter-rouge">ApplicationContext</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@Qualifier</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="nc">AnnotationRetention</span><span class="p">.</span><span class="nc">BINARY</span><span class="p">)</span>
<span class="k">annotation</span> <span class="kd">class</span> <span class="nc">ApplicationContext</span>
</pre></table></code></div></div><p>and respectively <code class="language-plaintext highlighter-rouge">ActivityContext</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@Qualifier</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="nc">AnnotationRetention</span><span class="p">.</span><span class="nc">BINARY</span><span class="p">)</span>
<span class="k">annotation</span> <span class="kd">class</span> <span class="nc">ActivityContext</span>
</pre></table></code></div></div><p>now our <code class="language-plaintext highlighter-rouge">SingletonComponent</code> looks cleaner.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@Singleton</span>
<span class="kd">interface</span> <span class="nc">SingletonComponent</span> <span class="p">{</span>

    <span class="nd">@Component</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">SingletonComponentFactory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="nd">@ApplicationContext</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">SingletonComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">activityComponentFactory</span><span class="p">():</span> <span class="nc">ActivityComponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="k">fun</span> <span class="nf">fragmentComponentFactory</span><span class="p">():</span> <span class="nc">FragmentComponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="k">fun</span> <span class="nf">provideGraphInside</span><span class="p">(</span><span class="n">application</span><span class="p">:</span> <span class="nc">DaggerIsEasyApplication</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Make the change inside the <code class="language-plaintext highlighter-rouge">ActivityComponent</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Subcomponent</span><span class="p">(</span><span class="n">modules</span> <span class="p">=</span> <span class="p">[</span><span class="nc">ActivityModule</span><span class="o">::</span><span class="k">class</span><span class="p">])</span>
<span class="nd">@ActivityScoped</span>
<span class="kd">interface</span> <span class="nc">ActivityComponent</span> <span class="p">{</span>

    <span class="nd">@Subcomponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">(</span><span class="nd">@BindsInstance</span> <span class="nd">@ActivityContext</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">ActivityComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">inject</span><span class="p">(</span><span class="n">mainActivity</span><span class="p">:</span> <span class="nc">MainActivity</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>now our <code class="language-plaintext highlighter-rouge">SharedPreferenceManager</code> looks cleaner too!</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nd">@Singleton</span>
<span class="kd">class</span> <span class="nc">SharedPreferencesManager</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span><span class="nd">@ApplicationContext</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">)</span> <span class="p">{</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This I see as an absolute win.</p><h2 id="broadcast-receivers-correct-place-for-injection">Broadcast receiver’s correct place for injection</h2><hr /><ul><li>If you have a receiver that is coming from the <code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code>, you can’t cast the <code class="language-plaintext highlighter-rouge">Context</code> to an application context since it’s mostly of a type <code class="language-plaintext highlighter-rouge">ReceiverRestrictedContext</code>, you can however create a separate graph.</ul><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@BroadcastScoped</span>
<span class="kd">interface</span> <span class="nc">BroadcastComponent</span> <span class="p">{</span>

    <span class="nd">@Component</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">():</span> <span class="nc">BroadcastComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">inject</span><span class="p">(</span><span class="n">bootReceiver</span><span class="p">:</span> <span class="nc">BootReceiver</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nd">@Scope</span>
<span class="nd">@MustBeDocumented</span>
<span class="nd">@Retention</span><span class="p">(</span><span class="nc">AnnotationRetention</span><span class="p">.</span><span class="nc">RUNTIME</span><span class="p">)</span>
<span class="k">annotation</span> <span class="kd">class</span> <span class="nc">BroadcastScoped</span>
</pre></table></code></div></div><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">BootReceiver</span> <span class="p">:</span> <span class="nc">BroadcastReceiver</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">?,</span> <span class="n">intent</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="c1">//do the injection here</span>
        <span class="nc">DaggerBroadcastComponent</span><span class="p">.</span><span class="nf">create</span><span class="p">().</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="c1">// you can have create accept the context and intent as @BindsInstance etc...</span>

        <span class="n">intent</span> <span class="o">?:</span> <span class="k">return</span>
        <span class="n">context</span> <span class="o">?:</span> <span class="k">return</span>
        <span class="kd">val</span> <span class="py">action</span> <span class="p">=</span> <span class="n">intent</span><span class="p">.</span><span class="n">action</span> <span class="o">?:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="p">==</span> <span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_BOOT_COMPLETED</span> <span class="p">||</span> <span class="n">action</span> <span class="p">==</span> <span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_LOCKED_BOOT_COMPLETED</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//some logic of your own</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><ul><li>Registering the receiver at runtime</ul><p>For the sake of <code class="language-plaintext highlighter-rouge">A.</code> and <code class="language-plaintext highlighter-rouge">B.</code> create a class</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">PowerLogger</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">sharedPreferencesManager</span><span class="p">:</span> <span class="nc">SharedPreferencesManager</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">fun</span> <span class="nf">logChargingStatus</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sharedPreferencesManager</span><span class="p">.</span><span class="nf">logChargingStatus</span><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="s">"IS CHARGING"</span> <span class="k">else</span> <span class="s">"CHARGING STOPPED"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>and inside the <code class="language-plaintext highlighter-rouge">sharedPreferenceManager</code> add a function</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">logChargingStatus</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">Log</span><span class="p">.</span><span class="nf">d</span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">simpleName</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>and Subcomponent that’ll inherit from <code class="language-plaintext highlighter-rouge">ApplicationComponent</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Subcomponent</span>
<span class="kd">interface</span> <span class="nc">RuntimeBroadcastComponent</span>
<span class="p">{</span>
    <span class="nd">@Subcomponent</span><span class="p">.</span><span class="nc">Factory</span>
    <span class="kd">interface</span> <span class="nc">Factory</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">create</span><span class="p">():</span> <span class="nc">RuntimeBroadcastComponent</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">inject</span><span class="p">(</span><span class="n">powerReceiver</span><span class="p">:</span> <span class="nc">PowerReceiver</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>don’t forget to add</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    <span class="k">fun</span> <span class="nf">runtimeBroadcastComponentFactory</span><span class="p">()</span> <span class="p">:</span> <span class="nc">RuntimeBroadcastComponent</span><span class="p">.</span><span class="nc">Factory</span>
</pre></table></code></div></div><p>inside the <code class="language-plaintext highlighter-rouge">ApplicationComponent</code> just as you did for the Fragment and Activity, this is only needed for <code class="language-plaintext highlighter-rouge">A.</code></p><p><code class="language-plaintext highlighter-rouge">A.</code> If you’re using field injection and manually registering the receiver (which is painful to do so, we’ll see simpler a bit below)</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">PowerReceiver</span> <span class="p">:</span> <span class="nc">BroadcastReceiver</span><span class="p">()</span> <span class="p">{</span>

    <span class="nd">@Inject</span>
    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">powerLogger</span><span class="p">:</span> <span class="nc">PowerLogger</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">?,</span> <span class="n">intent</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">context</span> <span class="o">?:</span> <span class="k">return</span>
        <span class="n">intent</span> <span class="o">?:</span> <span class="k">return</span>
        <span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">applicationContext</span> <span class="k">as</span> <span class="nc">DaggerIsEasyApplication</span><span class="p">).</span><span class="n">applicationComponent</span><span class="p">.</span><span class="nf">runtimeBroadcastComponentFactory</span><span class="p">().</span><span class="nf">create</span><span class="p">().</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

        <span class="kd">val</span> <span class="py">isCharging</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_DISCONNECTED</span> <span class="p">-&gt;</span> <span class="k">false</span>
            <span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_CONNECTED</span> <span class="p">-&gt;</span> <span class="k">true</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">null</span>
        <span class="p">}</span>
        <span class="n">isCharging</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">status</span> <span class="p">-&gt;</span>
            <span class="n">powerLogger</span><span class="p">.</span><span class="nf">logChargingStatus</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>inside <code class="language-plaintext highlighter-rouge">MainActivity</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">filter</span> <span class="p">=</span> <span class="nc">IntentFilter</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_CONNECTED</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span>
            <span class="n">it</span><span class="p">.</span><span class="nf">addAction</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_DISCONNECTED</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">registerReceiver</span><span class="p">(</span><span class="nc">PowerReceiver</span><span class="p">(),</span><span class="n">filter</span><span class="p">)</span>
</pre></table></code></div></div><p>when the power connects/disconnects we have the following</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/dagger/6/power_demonstration_1.png" class="center" /></p><p><code class="language-plaintext highlighter-rouge">B.</code> If you’re manually registering the receiver then you can use constructor injection to get an instance of your receiver and register it with that instance, since you’re using</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nf">registerReceiver</span><span class="p">(</span><span class="n">broadcastReceiver</span><span class="p">,</span> <span class="n">filter</span><span class="p">)</span>
</pre></table></code></div></div><p>which takes a <code class="language-plaintext highlighter-rouge">broadcastReceiver</code> instance and an intent filter.</p><p>If you’re using this approach you can go ahead and remove the <code class="language-plaintext highlighter-rouge">RuntimeBroadcastComponent</code> and remove it as a subcomponent from the <code class="language-plaintext highlighter-rouge">ApplicationComponent</code> also change <code class="language-plaintext highlighter-rouge">PowerReceiver</code> to</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">PowerReceiver</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">powerLogger</span><span class="p">:</span> <span class="nc">PowerLogger</span><span class="p">)</span> <span class="p">:</span> <span class="nc">BroadcastReceiver</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">?,</span> <span class="n">intent</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">context</span> <span class="o">?:</span> <span class="k">return</span>
        <span class="n">intent</span> <span class="o">?:</span> <span class="k">return</span>

        <span class="kd">val</span> <span class="py">isCharging</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_DISCONNECTED</span> <span class="p">-&gt;</span> <span class="k">false</span>
            <span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_CONNECTED</span> <span class="p">-&gt;</span> <span class="k">true</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">null</span>
        <span class="p">}</span>
        <span class="n">isCharging</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">status</span> <span class="p">-&gt;</span>
            <span class="n">powerLogger</span><span class="p">.</span><span class="nf">logChargingStatus</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>and <code class="language-plaintext highlighter-rouge">MainActivity</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="nf">addOnContextAvailableListener</span> <span class="p">{</span> <span class="n">availableContext-</span><span class="p">&gt;</span>
            <span class="nf">injector</span> <span class="p">{</span>
                <span class="nf">activityComponentFactory</span><span class="p">().</span><span class="nf">create</span><span class="p">(</span><span class="n">availableContext</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="nd">@MainActivity</span><span class="p">)</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nd">@Inject</span>
    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">powerReceiver</span><span class="p">:</span> <span class="nc">PowerReceiver</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="nf">setContentView</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>

        <span class="kd">val</span> <span class="py">filter</span> <span class="p">=</span> <span class="nc">IntentFilter</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_CONNECTED</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span>
            <span class="n">it</span><span class="p">.</span><span class="nf">addAction</span><span class="p">(</span><span class="nc">Intent</span><span class="p">.</span><span class="nc">ACTION_POWER_DISCONNECTED</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">registerReceiver</span><span class="p">(</span><span class="n">powerReceiver</span><span class="p">,</span><span class="n">filter</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>As you can see this is easier approach and as you’ve read in the beginning, always prefer constructor injection whenever possible.</p><h2 id="services-correct-place-for-injection">Service’s correct place for injection</h2><hr /><p>By now you know how to create a subcomponent or a component, you can get the context from the service, since you’ve started that service from an Activity/Fragment or a Context, that can be easily casted to <code class="language-plaintext highlighter-rouge">applicationContext</code> therefore easily creating a subcomponent of the <code class="language-plaintext highlighter-rouge">ApplicationComponent</code> or if your use case is different you’ll know soon enough where to create your graph unrelated to <code class="language-plaintext highlighter-rouge">ApplicationComponent</code>.</p><p>The correct place for the Service to be injected is inside <code class="language-plaintext highlighter-rouge">onCreate()</code> right before the <code class="language-plaintext highlighter-rouge">super.onCreate()</code> call, just as our <code class="language-plaintext highlighter-rouge">: Application</code></p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">LongRunningService</span> <span class="p">:</span> <span class="nc">Service</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onBind</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span> <span class="nc">Intent</span><span class="p">?):</span> <span class="nc">IBinder</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//the correct place to inject</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="work-manager">Work manager</h2><p>Let’s say we have a Worker class</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">ContentRecommendation</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">appContext</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span>
                            <span class="n">params</span><span class="p">:</span> <span class="nc">WorkerParameters</span><span class="p">,</span>
                            <span class="k">private</span> <span class="kd">val</span> <span class="py">defaultPrefs</span><span class="p">:</span> <span class="nc">SharedPreferences</span><span class="p">,</span>
                            <span class="k">private</span> <span class="kd">val</span> <span class="py">contentRecommendationAPI</span><span class="p">:</span> <span class="nc">ContentRecommendationAPI</span><span class="p">)</span> <span class="p">:</span> <span class="nc">CoroutineWorker</span><span class="p">(</span><span class="n">appContext</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> 
</pre></table></code></div></div><p>for this to work we need to create a WorkerFactory that creates ListenableWorker instances, the factory is invoked every time a work runs.</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">ContentFactory</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">defaultPrefs</span><span class="p">:</span> <span class="nc">SharedPreferences</span><span class="p">,</span>
                     <span class="k">private</span> <span class="kd">val</span> <span class="py">contentRecommendationAPI</span><span class="p">:</span> <span class="nc">ContentRecommendationAPI</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">WorkerFactory</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">createWorker</span><span class="p">(</span><span class="n">appContext</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span> <span class="n">workerClassName</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">workerParameters</span><span class="p">:</span> <span class="nc">WorkerParameters</span><span class="p">):</span> <span class="nc">ListenableWorker</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">workerClassName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">ContentRecommendation</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">.</span><span class="n">name</span> <span class="p">-&gt;</span>
                <span class="nc">ContentRecommendation</span><span class="p">(</span><span class="n">appContext</span><span class="p">,</span> <span class="n">workerParameters</span><span class="p">,</span> <span class="n">defaultPrefs</span><span class="p">,</span> <span class="n">contentRecommendationAPI</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">-&gt;</span>
                <span class="c1">// Return null, so that the base class can delegate to the default WorkerFactory.</span>
                <span class="k">null</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>then we also need the DelegatingWorkerFactory (injection factory) which delegates to other factories</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nd">@Singleton</span>
<span class="kd">class</span> <span class="nc">ContentRecommendationFactory</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
        <span class="n">defaultPrefs</span><span class="p">:</span> <span class="nc">SharedPreferences</span><span class="p">,</span>
        <span class="n">contentRecommendationAPI</span><span class="p">:</span> <span class="nc">ContentRecommendationAPI</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">DelegatingWorkerFactory</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">init</span> <span class="p">{</span>
        <span class="nf">addFactory</span><span class="p">(</span><span class="nc">ContentFactory</span><span class="p">(</span><span class="n">defaultPrefs</span><span class="p">,</span> <span class="n">contentRecommendationAPI</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>then inside <code class="language-plaintext highlighter-rouge">: Application</code> you have to implement <code class="language-plaintext highlighter-rouge">Configuration.Provider</code></p><p>and have something like</p><div class="language-kotlin highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">WorkerApplicationDemonstration</span> <span class="p">:</span> <span class="nc">Application</span><span class="p">(),</span> <span class="nc">Configuration</span><span class="p">.</span><span class="nc">Provider</span> <span class="p">{</span>

    <span class="nd">@Inject</span>
    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">contentRecommendationFactory</span><span class="p">:</span> <span class="nc">ContentRecommendationFactory</span>

    <span class="nd">@Inject</span>
    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">contentConfiguration</span><span class="p">:</span> <span class="nc">Configuration</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getWorkManagerConfiguration</span><span class="p">()</span> <span class="p">=</span> <span class="n">contentConfiguration</span>

    <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">appComponent</span><span class="p">:</span> <span class="nc">AppComponent</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">()</span>
        <span class="n">appComponent</span> <span class="p">=</span> <span class="nc">DaggerAppComponent</span><span class="p">.</span><span class="nf">factory</span><span class="p">().</span><span class="nf">create</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nf">also</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
        <span class="nc">WorkManager</span><span class="p">.</span><span class="nf">initialize</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">contentConfiguration</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p>You think it’s over? Nope…</p><p>Since we’ve created a custom factory, we have to disable (remove) the default initialization factory or ours won’t run.</p><p>Inside your <code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code></p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> <span class="nt">&lt;provider</span>
            <span class="na">android:name=</span><span class="s">"androidx.work.impl.WorkManagerInitializer"</span>
            <span class="na">android:authorities=</span><span class="s">"${applicationId}.workmanager-init"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span>
            <span class="na">tools:node=</span><span class="s">"remove"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><h2 id="whats-next">What’s next?</h2><hr /><p>Probably everyone’s wondering, why’s there no blog post about <strong>Hilt</strong> since it’s easier, yes <em>Hilt</em> is easier because it does all of this for you behind the scenes so that you don’t have to do it, there’s one more blog post about the dreaded but powerful <code class="language-plaintext highlighter-rouge">Multi bindings</code>, I won’t cover WorkManager’s injection using this example but you saw how much boilerplate we have to write and after the <code class="language-plaintext highlighter-rouge">Multi bindings</code> post we’re jumping to the Hilt train, which offers easier integration with <code class="language-plaintext highlighter-rouge">WorkManager</code> and with practically everything, not just <code class="language-plaintext highlighter-rouge">Workmanager</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/dagger/6/patterns.png" class="center" /></p><p><a href="/posts/dagger-part-7/">Part #7</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dagger/'>Dagger</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dagger/" class="post-tag no-text-decoration" >Dagger</a> <a href="/tags/kotlin/" class="post-tag no-text-decoration" >Kotlin</a> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Dagger2 is hard, but it can be easy, part 6 - FunkyMuse&url=https://funkymuse.github.io/posts/dagger-part-6/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Dagger2 is hard, but it can be easy, part 6 - FunkyMuse&u=https://funkymuse.github.io/posts/dagger-part-6/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Dagger2 is hard, but it can be easy, part 6 - FunkyMuse&url=https://funkymuse.github.io/posts/dagger-part-6/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://funkymuse.github.io/posts/dagger-part-6/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://www.reddit.com/submit?url=https://funkymuse.github.io/posts/dagger-part-6/&title=Dagger2 is hard, but it can be easy, part 6 - FunkyMuse" data-toggle="tooltip" data-placement="top" title="Reddit" target="_blank" rel="noopener" aria-label="Reddit"> <i class="fa-fw fab fa-reddit"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/dagger-part-5/"><div class="card-body"> <span class="timeago small" > Mar 29 <i class="unloaded">2021-03-29T22:45:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 5</h3><div class="text-muted small"><p> In the previous post we’ve explored scope operators. In this post we’ll encounter subcomponents and their hierarchy, custom scopes and let’s not waste any time. Starting off by including the an...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-7/"><div class="card-body"> <span class="timeago small" > Apr 6 <i class="unloaded">2021-04-06T23:55:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 7</h3><div class="text-muted small"><p> In the previous post we’ve encountered when’s the right place to inject, named and qualifiers. In this post we’ll learn about multi bindings and their power. They’re your best buddies in the Da...</p></div></div></a></div><div class="card"> <a href="/posts/dagger-part-1/"><div class="card-body"> <span class="timeago small" > Mar 1 <i class="unloaded">2021-03-01T15:46:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dagger2 is hard, but it can be easy, part 1</h3><div class="text-muted small"><p> One day you decided to use Dagger2 and then you were lost, don’t worry, most of us were already there, Dagger2 is easy, you’ll see, it’s literally one interface, let’s start. A little bit of his...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dagger-part-5/" class="btn btn-outline-primary" prompt="Older"><p>Dagger2 is hard, but it can be easy, part 5</p></a> <a href="/posts/dagger-part-7/" class="btn btn-outline-primary" prompt="Newer"><p>Dagger2 is hard, but it can be easy, part 7</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/funky_muse">FunkyMuse</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."> Some rights reserved. </span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/kotlin/">Kotlin</a> <a class="post-tag" href="/tags/dagger/">Dagger</a> <a class="post-tag" href="/tags/hilt/">Hilt</a> <a class="post-tag" href="/tags/gradle/">Gradle</a> <a class="post-tag" href="/tags/architecture-components/">Architecture Components</a> <a class="post-tag" href="/tags/compose/">Compose</a> <a class="post-tag" href="/tags/jetpack/">Jetpack</a> <a class="post-tag" href="/tags/optimizations/">Optimizations</a> <a class="post-tag" href="/tags/programming/">Programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://funkymuse.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
